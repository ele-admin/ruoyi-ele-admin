import{_ as W}from"./index-AmtRfZLy.js";import{aU as j,W as C,o as _,b,w as t,d as s,av as B,aw as P,s as p,e as w,ay as F,az as R,E as M,aB as S,an as E,b0 as U,b1 as I,b2 as K,b7 as Y,n as O,b8 as z,b9 as D,bg as A,a4 as q,ba as G,bb as H,ad as r,ae as N,aV as J}from"./index-B6yCc2m_.js";import{_ as T}from"./index-BJMucfID.js";import{a as Q}from"./index-C6QIYa0w.js";import{E as X,a as Z}from"./index-6AfRRrL-.js";import{E as ee}from"./date-picker-CO9Lkaff.js";import"./index-CtEHLY2Q.js";const oe={__name:"logininfor-search",emits:["search"],setup(i,{emit:a}){const y=a,[f,m]=j({ipaddr:"",userName:""}),g=C(["",""]),d=()=>{const[v,l]=g.value||[];y("search",{...f,params:{beginTime:v?`${v} 00:00:00`:"",endTime:l?`${l} 23:59:59`:""}})},L=()=>{m(),g.value=["",""],d()};return(v,l)=>{const $=F,o=R,e=X,n=ee,u=M,h=Z,x=S,k=T;return _(),b(k,{"body-style":{paddingBottom:"2px"}},{default:t(()=>[s(x,{"label-width":"72px",onKeyup:B(d,["enter"]),onSubmit:l[3]||(l[3]=P(()=>{},["prevent"]))},{default:t(()=>[s(h,{gutter:8},{default:t(()=>[s(e,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[s(o,{label:"登录地址"},{default:t(()=>[s($,{clearable:"",modelValue:p(f).ipaddr,"onUpdate:modelValue":l[0]||(l[0]=c=>p(f).ipaddr=c),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),s(e,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[s(o,{label:"用户名称"},{default:t(()=>[s($,{clearable:"",modelValue:p(f).userName,"onUpdate:modelValue":l[1]||(l[1]=c=>p(f).userName=c),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),s(e,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[s(o,{label:"登录时间"},{default:t(()=>[s(n,{"unlink-panels":"",type:"daterange",modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=c=>g.value=c),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),s(e,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[s(o,{"label-width":"16px"},{default:t(()=>[s(u,{type:"primary",onClick:d},{default:t(()=>l[4]||(l[4]=[w("查询")])),_:1}),s(u,{onClick:L},{default:t(()=>l[5]||(l[5]=[w("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function te(i){const a=await E.get("/monitor/logininfor/list",{params:i});return a.data.code===200?a.data:Promise.reject(new Error(a.data.msg))}async function ne(i){const a=await E({url:"/monitor/logininfor/export",method:"POST",data:U(i),responseType:"blob"});await I(a),K(a.data,`logininfor_${Date.now()}.xlsx`)}async function ae(i){const a=await E.delete("/monitor/logininfor/"+i.join());return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}async function se(){const i=await E.delete("/monitor/logininfor/clean");return i.data.code===200?i.data.msg:Promise.reject(new Error(i.data.msg))}async function le(i){const a=await E.get("/monitor/logininfor/unlock/"+i);return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}const fe=Object.assign({name:"SystemLogLogininfor"},{__name:"index",setup(i){const[a]=Y(["sys_common_status"]),y=C(null),f=O(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"userName",label:"用户名称",sortable:"custom",align:"center",minWidth:110},{prop:"ipaddr",label:"登录地址",align:"center",minWidth:110},{prop:"loginLocation",label:"登录地点",align:"center",minWidth:110},{prop:"browser",label:"浏览器",align:"center",minWidth:110},{prop:"os",label:"操作系统",align:"center",minWidth:110},{prop:"status",label:"登录状态",width:110,slot:"status",align:"center",filters:a.value.map(o=>({text:o.dictLabel,value:o.dictValue})),filterMultiple:!1,formatter:o=>{var e;return(e=a.value.find(n=>n.dictValue==o.status))==null?void 0:e.dictLabel}},{prop:"msg",label:"操作信息",align:"center",minWidth:110},{prop:"loginTime",label:"登录日期",sortable:"custom",align:"center",width:180}]),m=C([]),g=({pages:o,where:e,orders:n,filters:u})=>te({...e,...n,...u,...o}),d=o=>{var e,n;(n=(e=y.value)==null?void 0:e.reload)==null||n.call(e,{page:1,where:o})},L=()=>{var e,n;const o=r.loading({message:"请求中..",plain:!0});(n=(e=y.value)==null?void 0:e.fetch)==null||n.call(e,({where:u,orders:h,filters:x})=>{ne({...u,...h,...x}).then(()=>{o.close()}).catch(k=>{o.close(),r.error(k.message)})})},v=()=>{if(!m.value.length){r.error("请至少选择一条数据");return}const o=m.value.map(e=>e.infoId);N.confirm(`是否确认删除访问编号为"${o.join()}"的数据项?`,"系统提示",{type:"warning",draggable:!0,customStyle:{maxWidth:"442px"}}).then(()=>{const e=r.loading({message:"请求中..",plain:!0});ae(o).then(()=>{e.close(),r.success("删除成功"),d()}).catch(n=>{e.close(),r.error(n.message)})}).catch(()=>{})},l=()=>{N.confirm("是否确认清空所有登录日志数据项？","系统提示",{type:"warning",draggable:!0}).then(()=>{const o=r.loading({message:"请求中..",plain:!0});se().then(()=>{o.close(),r.success("清空成功"),d()}).catch(e=>{o.close(),r.error(e.message)})}).catch(()=>{})},$=()=>{if(!m.value.length){r.error("请选择一条数据");return}if(m.value.length!==1){r.error("只能选择一条数据");return}const o=m.value[0].userName;N.confirm(`是否确认解锁用户"${o}"数据项?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const e=r.loading({message:"请求中..",plain:!0});le(o).then(()=>{e.close(),r.success(`用户${o}解锁成功`),d()}).catch(n=>{e.close(),r.error(n.message)})}).catch(()=>{})};return(o,e)=>{const n=M,u=J,h=Q,x=T,k=W,c=z("permission");return _(),b(k,null,{default:t(()=>[s(oe,{onSearch:d}),s(x,{"body-style":{paddingTop:"8px"}},{default:t(()=>[s(h,{ref_key:"tableRef",ref:y,"row-key":"infoId",columns:f.value,datasource:g,"show-overflow-tooltip":!0,selections:m.value,"onUpdate:selections":e[1]||(e[1]=V=>m.value=V),"highlight-current-row":"","export-config":{fileName:"登录日志"},"cache-key":"systemLogLogininforTable"},{toolbar:t(()=>[D((_(),b(n,{type:"primary",class:"ele-btn-icon",icon:p(A),onClick:$},{default:t(()=>e[2]||(e[2]=[w(" 解锁 ")])),_:1},8,["icon"])),[[c,"monitor:logininfor:unlock"]]),D((_(),b(n,{type:"danger",class:"ele-btn-icon",icon:p(q),onClick:e[0]||(e[0]=V=>v())},{default:t(()=>e[3]||(e[3]=[w(" 删除 ")])),_:1},8,["icon"])),[[c,"monitor:logininfor:remove"]]),D((_(),b(n,{plain:"",type:"danger",class:"ele-btn-icon hidden-sm-and-down",icon:p(G),onClick:l},{default:t(()=>e[4]||(e[4]=[w(" 清空 ")])),_:1},8,["icon"])),[[c,"monitor:logininfor:remove"]]),D((_(),b(n,{class:"ele-btn-icon",icon:p(H),onClick:L},{default:t(()=>e[5]||(e[5]=[w(" 导出 ")])),_:1},8,["icon"])),[[c,"monitor:logininfor:export"]])]),status:t(({row:V})=>[s(u,{code:"sys_common_status",type:"tag","model-value":V.status},null,8,["model-value"])]),_:1},8,["columns","selections"])]),_:1})]),_:1})}}});export{fe as default};
