import{_ as I}from"./index-AmtRfZLy.js";import{aU as B,o as W,b as N,w as o,d as n,av as C,aw as R,s as g,e as x,ay as $,az as O,E as P,aB as T,an as M,b6 as j,W as h,n as F,bh as K,ae as Y,ad as w,a8 as D}from"./index-B6yCc2m_.js";import{_ as V}from"./index-BJMucfID.js";import{a as L}from"./index-C6QIYa0w.js";import{E as U,a as H}from"./index-6AfRRrL-.js";const S={__name:"online-search",emits:["search"],setup(m,{expose:l,emit:u}){const p=u,[r,c]=B({ipaddr:"",userName:""}),s=()=>{p("search",{...r})},d=()=>{c(),s()};return l({getWhere:()=>r}),(v,e)=>{const t=$,a=O,i=U,f=P,b=H,_=T,E=V;return W(),N(E,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[n(_,{"label-width":"72px",onKeyup:C(s,["enter"]),onSubmit:e[2]||(e[2]=R(()=>{},["prevent"]))},{default:o(()=>[n(b,{gutter:8},{default:o(()=>[n(i,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[n(a,{label:"登录地址"},{default:o(()=>[n(t,{clearable:"",modelValue:g(r).ipaddr,"onUpdate:modelValue":e[0]||(e[0]=y=>g(r).ipaddr=y),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),n(i,{lg:6,md:8,sm:12,xs:24},{default:o(()=>[n(a,{label:"登录名称"},{default:o(()=>[n(t,{clearable:"",modelValue:g(r).userName,"onUpdate:modelValue":e[1]||(e[1]=y=>g(r).userName=y),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),n(i,{lg:12,md:8,sm:24,xs:24},{default:o(()=>[n(a,{"label-width":"16px"},{default:o(()=>[n(f,{type:"primary",onClick:s},{default:o(()=>e[3]||(e[3]=[x("查询")])),_:1}),n(f,{onClick:d},{default:o(()=>e[4]||(e[4]=[x("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function z(m){const l=await M.get("/monitor/online/list",{params:m});return l.data.code===200?l.data:Promise.reject(new Error(l.data.msg))}async function q(m){const l=await M.delete("/monitor/online/"+m);return l.data.code===200?l.data.msg:Promise.reject(new Error(l.data.msg))}const Z=Object.assign({name:"MonitorOnline"},{__name:"index",setup(m){const{hasPermission:l}=j(),u=h(null),p=h(null),r=F(()=>{const e=[{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"tokenId",label:"会话编号",align:"center",minWidth:160},{prop:"userName",label:"登录名称",align:"center",minWidth:110},{prop:"deptName",label:"部门名称",align:"center",minWidth:110},{prop:"ipaddr",label:"登录地址",align:"center",minWidth:140},{prop:"loginLocation",label:"登录地点",align:"center",minWidth:110},{prop:"browser",label:"浏览器",align:"center",minWidth:110},{prop:"os",label:"操作系统",align:"center",minWidth:110},{prop:"loginTime",label:"登录时间",align:"center",width:180,formatter:t=>K(t.loginTime).format("YYYY-MM-DD HH:mm:ss")}];return l("monitor:online:forceLogout")&&e.push({columnKey:"action",label:"操作",width:80,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}),e}),c=h([]),s=h(!1),d=e=>{s.value=!0,z(e).then(t=>{var a,i;s.value=!1,c.value=t.rows,(i=(a=p.value)==null?void 0:a.reload)==null||i.call(a,{page:1})}).catch(t=>{s.value=!1,console.error(t)})},k=e=>{Y.confirm("是否确认强退名称为“"+e.userName+"”的用户？","系统提示",{type:"warning",draggable:!0}).then(()=>{const t=w.loading({message:"请求中..",plain:!0});q(e.tokenId).then(()=>{t.close(),w.success("强退成功"),d()}).catch(a=>{t.close(),w.error(a.message)})}).catch(()=>{})},v=()=>{var e,t;return(t=(e=u.value)==null?void 0:e.getWhere)==null?void 0:t.call(e)};return d(),(e,t)=>{const a=D,i=L,f=V,b=I;return W(),N(b,null,{default:o(()=>[n(S,{ref_key:"searchRef",ref:u,onSearch:d},null,512),n(f,{"body-style":{paddingTop:"8px"}},{default:o(()=>[n(i,{ref_key:"tableRef",ref:p,"row-key":"tokenId",columns:r.value,datasource:c.value,"show-overflow-tooltip":!0,loading:s.value,"highlight-current-row":"","export-config":{fileName:"在线用户",datasource:async()=>c.value},"print-config":{datasource:async()=>c.value},"cache-key":"monitorOnlineTable",onRefresh:t[0]||(t[0]=_=>d(v()))},{action:o(({row:_})=>[n(a,{type:"danger",underline:!1,onClick:E=>k(_)},{default:o(()=>t[1]||(t[1]=[x(" 强退 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","datasource","loading","export-config","print-config"])]),_:1})]),_:1})}}});export{Z as default};
