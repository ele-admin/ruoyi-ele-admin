import{_ as L}from"./index-AmtRfZLy.js";import{aU as P,W as T,o as x,b as k,w as n,d as o,av as z,aw as F,s as c,e as y,ay as O,az as R,E as j,aB as W,an as U,b0 as A,b1 as G,b2 as H,a$ as B,aW as J,aq as Q,ad as _,aI as I,aV as S,ah as X,b7 as Z,n as ee,b8 as te,b9 as K,bd as oe,a4 as ne,bb as ae,bv as le,ae as se,a8 as ie,af as re}from"./index-B6yCc2m_.js";import{_ as Y}from"./index-BJMucfID.js";import{a as de}from"./index-C6QIYa0w.js";import{E as ce,a as me}from"./index-6AfRRrL-.js";import{E as ue}from"./date-picker-CO9Lkaff.js";import"./index-CtEHLY2Q.js";const fe={__name:"config-search",emits:["search"],setup(m,{emit:s}){const C=s,[b,v]=P({configName:"",configKey:""}),p=T(["",""]),g=()=>{const[r,d]=p.value||[];C("search",{...b,params:{beginTime:r,endTime:d}})},$=()=>{v(),p.value=["",""],g()};return(r,d)=>{const h=O,E=R,V=ce,l=ue,e=j,a=me,t=W,f=Y;return x(),k(f,{"body-style":{paddingBottom:"2px"}},{default:n(()=>[o(t,{"label-width":"72px",onKeyup:z(g,["enter"]),onSubmit:d[3]||(d[3]=F(()=>{},["prevent"]))},{default:n(()=>[o(a,{gutter:8},{default:n(()=>[o(V,{lg:6,md:12,sm:12,xs:24},{default:n(()=>[o(E,{label:"参数名称"},{default:n(()=>[o(h,{clearable:"",modelValue:c(b).configName,"onUpdate:modelValue":d[0]||(d[0]=u=>c(b).configName=u),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),o(V,{lg:6,md:12,sm:12,xs:24},{default:n(()=>[o(E,{label:"参数键名"},{default:n(()=>[o(h,{clearable:"",modelValue:c(b).configKey,"onUpdate:modelValue":d[1]||(d[1]=u=>c(b).configKey=u),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),o(V,{lg:6,md:12,sm:12,xs:24},{default:n(()=>[o(E,{label:"创建时间"},{default:n(()=>[o(l,{"unlink-panels":"",type:"daterange",modelValue:p.value,"onUpdate:modelValue":d[2]||(d[2]=u=>p.value=u),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),o(V,{lg:6,md:12,sm:12,xs:24},{default:n(()=>[o(E,{"label-width":"16px"},{default:n(()=>[o(e,{type:"primary",onClick:g},{default:n(()=>d[4]||(d[4]=[y("查询")])),_:1}),o(e,{onClick:$},{default:n(()=>d[5]||(d[5]=[y("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function pe(m){const s=await U.get("/system/config/list",{params:m});return s.data.code===200?s.data:Promise.reject(new Error(s.data.msg))}async function ge(m){const s=await U.post("/system/config",m);return s.data.code===200?s.data.msg:Promise.reject(new Error(s.data.msg))}async function _e(m){const s=await U.put("/system/config",m);return s.data.code===200?s.data.msg:Promise.reject(new Error(s.data.msg))}async function ye(m){const s=await U.delete("/system/config/"+m.join());return s.data.code===200?s.data.msg:Promise.reject(new Error(s.data.msg))}async function be(m){const s=await U({url:"/system/config/export",method:"POST",data:A(m),responseType:"blob"});await G(s),H(s.data,`config_${Date.now()}.xlsx`)}async function ve(){const m=await U.delete("/system/config/refreshCache");return m.data.code===200?m.data.msg:Promise.reject(new Error(m.data.msg))}const Ve={__name:"config-edit",props:B({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(m,{emit:s}){const C=m,b=s,v=J(m,"modelValue"),p=T(!1),g=T(!1),$=T(null),[r,d,h]=P({configId:void 0,configName:"",configKey:"",configValue:"",configType:"Y",remark:""}),E=Q({configName:[{required:!0,message:"请输入参数名称",type:"string",trigger:"blur"}],configKey:[{required:!0,message:"请输入参数键名",type:"string",trigger:"blur"}],configValue:[{required:!0,message:"请输入参数键值",type:"string",trigger:"blur"}]}),V=()=>{v.value=!1},l=()=>{var a,t;(t=(a=$.value)==null?void 0:a.validate)==null||t.call(a,f=>{if(!f)return;g.value=!0,(p.value?_e:ge)(r).then(D=>{g.value=!1,_.success(D),V(),b("done")}).catch(D=>{g.value=!1,_.error(D.message)})})},e=()=>{C.data?(h(C.data),p.value=!0):(d(),p.value=!1),I(()=>{I(()=>{var a,t;(t=(a=$.value)==null?void 0:a.clearValidate)==null||t.call(a)})})};return(a,t)=>{const f=O,u=R,D=S,M=W,N=j,w=X;return x(),k(w,{form:"",width:460,modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=i=>v.value=i),title:p.value?"修改参数":"添加参数",onOpen:e},{footer:n(()=>[o(N,{onClick:V},{default:n(()=>t[7]||(t[7]=[y("取消")])),_:1}),o(N,{type:"primary",loading:g.value,onClick:l},{default:n(()=>t[8]||(t[8]=[y(" 保存 ")])),_:1},8,["loading"])]),default:n(()=>[o(M,{ref_key:"formRef",ref:$,model:c(r),rules:E,"label-width":"80px",onSubmit:t[5]||(t[5]=F(()=>{},["prevent"]))},{default:n(()=>[o(u,{label:"参数名称",prop:"configName"},{default:n(()=>[o(f,{clearable:"",modelValue:c(r).configName,"onUpdate:modelValue":t[0]||(t[0]=i=>c(r).configName=i),placeholder:"请输入参数名称"},null,8,["modelValue"])]),_:1}),o(u,{label:"参数键名",prop:"configKey"},{default:n(()=>[o(f,{clearable:"",modelValue:c(r).configKey,"onUpdate:modelValue":t[1]||(t[1]=i=>c(r).configKey=i),placeholder:"请输入参数键名"},null,8,["modelValue"])]),_:1}),o(u,{label:"参数键值",prop:"configValue"},{default:n(()=>[o(f,{clearable:"",modelValue:c(r).configValue,"onUpdate:modelValue":t[2]||(t[2]=i=>c(r).configValue=i),placeholder:"请输入参数键值"},null,8,["modelValue"])]),_:1}),o(u,{label:"系统内置",prop:"configType"},{default:n(()=>[o(D,{code:"sys_yes_no",type:"radio",modelValue:c(r).configType,"onUpdate:modelValue":t[3]||(t[3]=i=>c(r).configType=i)},null,8,["modelValue"])]),_:1}),o(u,{label:"备注"},{default:n(()=>[o(f,{rows:4,type:"textarea",modelValue:c(r).remark,"onUpdate:modelValue":t[4]||(t[4]=i=>c(r).remark=i),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},he=Object.assign({name:"SystemConfig"},{__name:"index",setup(m){const[s]=Z(["sys_yes_no"]),C=T(null),b=ee(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"configName",label:"参数名称",align:"center",minWidth:110},{prop:"configKey",label:"参数键名",align:"center",minWidth:110},{prop:"configValue",label:"参数键值",align:"center",minWidth:110},{prop:"configType",label:"系统内置",width:110,align:"center",slot:"configType",filters:s.value.map(l=>({text:l.dictLabel,value:l.dictValue})),filterMultiple:!1,formatter:l=>{var e;return(e=s.value.find(a=>a.dictValue==l.configType))==null?void 0:e.dictLabel}},{prop:"remark",label:"备注",align:"center",minWidth:110},{prop:"createTime",label:"创建时间",align:"center",width:180},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),v=T([]),p=T(null),g=T(!1),$=({pages:l,where:e,filters:a})=>pe({...e,...a,...l}),r=l=>{var e,a;(a=(e=C.value)==null?void 0:e.reload)==null||a.call(e,{page:1,where:l})},d=l=>{p.value=l!=null?l:null,g.value=!0},h=l=>{const e=l==null?v.value:[l];if(!e.length){_.error("请至少选择一条数据");return}se.confirm(`是否确认删除参数键名为"${e.map(a=>a.configKey).join()}"的数据项?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const a=_.loading({message:"请求中..",plain:!0});ye(e.map(t=>t.configId)).then(()=>{a.close(),_.success("删除成功"),r()}).catch(t=>{a.close(),_.error(t.message)})}).catch(()=>{})},E=()=>{var e,a;const l=_.loading({message:"请求中..",plain:!0});(a=(e=C.value)==null?void 0:e.fetch)==null||a.call(e,({where:t,orders:f})=>{be({...t,...f}).then(()=>{l.close()}).catch(u=>{l.close(),_.error(u.message)})})},V=()=>{const l=_.loading({message:"请求中..",plain:!0});ve().then(()=>{l.close(),_.success("刷新成功")}).catch(e=>{l.close(),_.error(e.message)})};return(l,e)=>{const a=j,t=S,f=ie,u=re,D=de,M=Y,N=L,w=te("permission");return x(),k(N,null,{default:n(()=>[o(fe,{onSearch:r}),o(M,{"body-style":{paddingTop:"8px"}},{default:n(()=>[o(D,{ref_key:"tableRef",ref:C,"row-key":"configId",columns:b.value,datasource:$,"show-overflow-tooltip":!0,selections:v.value,"onUpdate:selections":e[2]||(e[2]=i=>v.value=i),"highlight-current-row":"","export-config":{fileName:"参数设置"},"cache-key":"systemConfigTable"},{toolbar:n(()=>[K((x(),k(a,{type:"primary",class:"ele-btn-icon",icon:c(oe),onClick:e[0]||(e[0]=i=>d())},{default:n(()=>e[4]||(e[4]=[y(" 新建 ")])),_:1},8,["icon"])),[[w,"system:config:add"]]),K((x(),k(a,{type:"danger",class:"ele-btn-icon hidden-sm-and-down",icon:c(ne),onClick:e[1]||(e[1]=i=>h())},{default:n(()=>e[5]||(e[5]=[y(" 删除 ")])),_:1},8,["icon"])),[[w,"system:config:remove"]]),K((x(),k(a,{class:"ele-btn-icon",icon:c(ae),onClick:E},{default:n(()=>e[6]||(e[6]=[y(" 导出 ")])),_:1},8,["icon"])),[[w,"system:config:export"]]),K((x(),k(a,{class:"ele-btn-icon",icon:c(le),onClick:V},{default:n(()=>e[7]||(e[7]=[y(" 刷新缓存 ")])),_:1},8,["icon"])),[[w,"system:config:remove"]])]),configType:n(({row:i})=>[o(t,{code:"sys_yes_no",type:"tag","model-value":i.configType},null,8,["model-value"])]),action:n(({row:i})=>[K((x(),k(f,{type:"primary",underline:!1,onClick:q=>d(i)},{default:n(()=>e[8]||(e[8]=[y(" 修改 ")])),_:2},1032,["onClick"])),[[w,"system:config:edit"]]),K(o(u,{direction:"vertical"},null,512),[[w,["system:config:edit","system:config:remove"]]]),K((x(),k(f,{type:"danger",underline:!1,onClick:q=>h(i)},{default:n(()=>e[9]||(e[9]=[y(" 删除 ")])),_:2},1032,["onClick"])),[[w,"system:config:remove"]])]),_:1},8,["columns","selections"])]),_:1}),o(Ve,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=i=>g.value=i),data:p.value,onDone:r},null,8,["modelValue","data"])]),_:1})}}});export{he as default};
