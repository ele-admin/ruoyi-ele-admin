import{_ as R}from"./index-AmtRfZLy.js";import{aU as F,W as D,o as V,b as k,w as t,d as a,av as K,aw as Y,s as h,e as g,ay as q,az as z,E as L,aB as A,_ as H,a$ as G,aW as J,aq as Q,aN as X,a as w,x as u,t as Z,aV as j,a9 as ee,ah as te,an as M,b0 as ae,b1 as oe,b2 as le,b6 as se,b7 as ne,n as re,b8 as ie,b9 as P,a4 as de,ba as ce,bb as ue,ad as b,ae as W,a8 as me}from"./index-B6yCc2m_.js";import{_ as S}from"./index-BJMucfID.js";import{a as pe}from"./index-C6QIYa0w.js";import{E as fe,a as _e}from"./index-6AfRRrL-.js";import{E as be}from"./date-picker-CO9Lkaff.js";/* empty css                          */import{E as ge,a as ye}from"./index-BQVafdAu.js";import"./index-CtEHLY2Q.js";const ve={__name:"operlog-search",emits:["search"],setup(o,{emit:r}){const y=r,[m,T]=F({title:"",operName:""}),f=D(["",""]),_=()=>{const[c,n]=f.value||[];y("search",{...m,params:{beginTime:c?`${c} 00:00:00`:"",endTime:n?`${n} 23:59:59`:""}})},i=()=>{T(),f.value=["",""],_()};return(c,n)=>{const v=q,x=z,E=fe,I=be,$=L,s=_e,e=A,l=S;return V(),k(l,{"body-style":{paddingBottom:"2px"}},{default:t(()=>[a(e,{"label-width":"72px",onKeyup:K(_,["enter"]),onSubmit:n[3]||(n[3]=Y(()=>{},["prevent"]))},{default:t(()=>[a(s,{gutter:8},{default:t(()=>[a(E,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"系统模块"},{default:t(()=>[a(v,{clearable:"",modelValue:h(m).title,"onUpdate:modelValue":n[0]||(n[0]=d=>h(m).title=d),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(E,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"操作人员"},{default:t(()=>[a(v,{clearable:"",modelValue:h(m).operName,"onUpdate:modelValue":n[1]||(n[1]=d=>h(m).operName=d),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(E,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"操作时间"},{default:t(()=>[a(I,{"unlink-panels":"",type:"daterange",modelValue:f.value,"onUpdate:modelValue":n[2]||(n[2]=d=>f.value=d),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),a(E,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{"label-width":"16px"},{default:t(()=>[a($,{type:"primary",onClick:_},{default:t(()=>n[4]||(n[4]=[g("查询")])),_:1}),a($,{onClick:i},{default:t(()=>n[5]||(n[5]=[g("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},xe={style:{"word-break":"break-all"}},we={style:{"word-break":"break-all"}},he={__name:"operlog-detail",props:G({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(o){const r=J(o,"modelValue"),y=Q({popperStyle:{width:"580px",maxWidth:"90%",wordBreak:"break-all"},bodyStyle:{maxWidth:"calc(100vw - 32px)",maxHeight:"252px",overflowY:"auto","--ele-scrollbar-color":"#5e5e5e","--ele-scrollbar-hover-color":"#707070","--ele-scrollbar-size":"8px"},offset:4,placement:"top"}),{mobile:m}=X();return(T,f)=>{const _=j,i=ge,c=ee,n=ye,v=te;return V(),k(v,{title:"详情",width:720,"body-style":{paddingTop:"6px"},modelValue:r.value,"onUpdate:modelValue":f[0]||(f[0]=x=>r.value=x)},{default:t(()=>[a(n,{border:!0,column:h(m)?1:2,class:"detail-table"},{default:t(()=>[a(i,{label:"操作模块"},{default:t(()=>[w("div",null,[w("span",null,u(o.data.title)+" / ",1),a(_,{code:"sys_oper_type",type:"text","model-value":o.data.businessType},null,8,["model-value"])])]),_:1}),a(i,{label:"请求地址"},{default:t(()=>[w("div",null,u(o.data.operUrl),1)]),_:1}),a(i,{label:"请求方式"},{default:t(()=>[w("div",null,u(o.data.requestMethod),1)]),_:1}),a(i,{label:"操作时间"},{default:t(()=>[w("div",null,u(o.data.operTime),1)]),_:1}),a(i,{label:"登录信息",span:2},{default:t(()=>[w("div",xe,u(o.data.operName)+" / "+u(o.data.operIp)+" / "+u(o.data.operLocation),1)]),_:1}),a(i,{label:"操作方法",span:2},{default:t(()=>[w("div",we,u(o.data.method),1)]),_:1}),a(i,{label:"请求参数",span:2},{default:t(()=>[a(c,{"max-line":4,tooltip:y},{default:t(()=>[g(u(o.data.operParam),1)]),_:1},8,["tooltip"])]),_:1}),a(i,{label:"返回参数",span:2},{default:t(()=>[a(c,{"max-line":4,tooltip:y},{default:t(()=>[g(u(o.data.jsonResult),1)]),_:1},8,["tooltip"])]),_:1}),a(i,{label:"操作状态"},{default:t(()=>[a(_,{code:"sys_common_status",type:"tag","model-value":o.data.status},null,8,["model-value"])]),_:1}),a(i,{label:"消耗时间"},{default:t(()=>[w("div",null,u(o.data.costTime)+"毫秒",1)]),_:1}),o.data.status===1?(V(),k(i,{key:0,label:"异常信息",span:2},{default:t(()=>[a(c,{"max-line":4,tooltip:y},{default:t(()=>[g(u(o.data.errorMsg),1)]),_:1},8,["tooltip"])]),_:1})):Z("",!0)]),_:1},8,["column"])]),_:1},8,["modelValue"])}}},Ve=H(he,[["__scopeId","data-v-c28229e7"]]);async function ke(o){const r=await M.get("/monitor/operlog/list",{params:o});return r.data.code===200?r.data:Promise.reject(new Error(r.data.msg))}async function Te(o){const r=await M({url:"/monitor/operlog/export",method:"POST",data:ae(o),responseType:"blob"});await oe(r),le(r.data,`operlog_${Date.now()}.xlsx`)}async function Ee(o){const r=await M.delete("/monitor/operlog/"+o.join());return r.data.code===200?r.data.msg:Promise.reject(new Error(r.data.msg))}async function De(){const o=await M.delete("/monitor/operlog/clean");return o.data.code===200?o.data.msg:Promise.reject(new Error(o.data.msg))}const je=Object.assign({name:"SystemLogOperlog"},{__name:"index",setup(o){const{hasPermission:r}=se(),[y,m]=ne(["sys_common_status","sys_oper_type"]),T=D(null),f=re(()=>{const s=[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"title",label:"系统模块",align:"center",minWidth:110},{prop:"businessType",label:"操作类型",width:110,slot:"businessType",align:"center",filters:m.value.map(e=>({text:e.dictLabel,value:e.dictValue})),filterMultiple:!1,formatter:e=>{var l;return(l=m.value.find(d=>d.dictValue==e.businessType))==null?void 0:l.dictLabel}},{prop:"operName",label:"操作人员",sortable:"custom",align:"center",minWidth:110},{prop:"operIp",label:"操作地址",align:"center",minWidth:110},{prop:"operLocation",label:"操作地点",align:"center",minWidth:110},{prop:"status",label:"操作状态",width:110,slot:"status",align:"center",filters:y.value.map(e=>({text:e.dictLabel,value:e.dictValue})),filterMultiple:!1,formatter:e=>{var l;return(l=y.value.find(d=>d.dictValue==e.status))==null?void 0:l.dictLabel}},{prop:"operTime",label:"操作日期",sortable:"custom",align:"center",minWidth:110},{prop:"costTime",label:"消耗时间",sortable:"custom",align:"center",formatter:e=>`${e.costTime}毫秒`,width:110}];return r("monitor:operlog:query")&&s.push({columnKey:"action",label:"操作",width:80,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}),s}),_=D({}),i=D(!1),c=D([]),n=({pages:s,where:e,orders:l,filters:d})=>ke({...e,...l,...d,...s}),v=s=>{var e,l;(l=(e=T.value)==null?void 0:e.reload)==null||l.call(e,{page:1,where:s})},x=s=>{_.value=s,i.value=!0},E=()=>{var e,l;const s=b.loading({message:"请求中..",plain:!0});(l=(e=T.value)==null?void 0:e.fetch)==null||l.call(e,({where:d,orders:N,filters:B})=>{Te({...d,...N,...B}).then(()=>{s.close()}).catch(C=>{s.close(),b.error(C.message)})})},I=()=>{if(!c.value.length){b.error("请至少选择一条数据");return}const s=c.value.map(e=>e.operId);W.confirm(`是否确认删除日志编号为"${s.join()}"的数据项?`,"系统提示",{type:"warning",draggable:!0,customStyle:{maxWidth:"442px"}}).then(()=>{const e=b.loading({message:"请求中..",plain:!0});Ee(s).then(()=>{e.close(),b.success("删除成功"),v()}).catch(l=>{e.close(),b.error(l.message)})}).catch(()=>{})},$=()=>{W.confirm("是否确认清空所有操作日志数据项？","系统提示",{type:"warning",draggable:!0}).then(()=>{const s=b.loading({message:"请求中..",plain:!0});De().then(()=>{s.close(),b.success("清空成功"),v()}).catch(e=>{s.close(),b.error(e.message)})}).catch(()=>{})};return(s,e)=>{const l=L,d=j,N=me,B=pe,C=S,U=R,O=ie("permission");return V(),k(U,null,{default:t(()=>[a(ve,{onSearch:v}),a(C,{"body-style":{paddingTop:"8px"}},{default:t(()=>[a(B,{ref_key:"tableRef",ref:T,"row-key":"operId",columns:f.value,datasource:n,"show-overflow-tooltip":!0,selections:c.value,"onUpdate:selections":e[1]||(e[1]=p=>c.value=p),"highlight-current-row":"","export-config":{fileName:"操作日志"},"cache-key":"systemLogOperlogTable"},{toolbar:t(()=>[P((V(),k(l,{type:"danger",class:"ele-btn-icon",icon:h(de),onClick:e[0]||(e[0]=p=>I())},{default:t(()=>e[3]||(e[3]=[g(" 删除 ")])),_:1},8,["icon"])),[[O,"monitor:operlog:remove"]]),P((V(),k(l,{plain:"",type:"danger",class:"ele-btn-icon",icon:h(ce),onClick:$},{default:t(()=>e[4]||(e[4]=[g(" 清空 ")])),_:1},8,["icon"])),[[O,"monitor:operlog:remove"]]),P((V(),k(l,{class:"ele-btn-icon",icon:h(ue),onClick:E},{default:t(()=>e[5]||(e[5]=[g(" 导出 ")])),_:1},8,["icon"])),[[O,"monitor:operlog:export"]])]),status:t(({row:p})=>[a(d,{code:"sys_common_status",type:"tag","model-value":p.status},null,8,["model-value"])]),businessType:t(({row:p})=>[a(d,{code:"sys_oper_type",type:"tag","model-value":p.businessType},null,8,["model-value"])]),action:t(({row:p})=>[a(N,{type:"primary",underline:!1,onClick:$e=>x(p)},{default:t(()=>e[6]||(e[6]=[g(" 详情 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1}),a(Ve,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=p=>i.value=p),data:_.value},null,8,["modelValue","data"])]),_:1})}}});export{je as default};
