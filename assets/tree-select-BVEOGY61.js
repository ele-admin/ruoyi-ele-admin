import{u as U,ai as A,aI as x,eg as S,aE as q,bM as j,d3 as E,n as g,m as P,bL as H,aF as p,cu as z,cK as D,eF as G,cM as W,cv as X,dn as $,aD as J,eG as Q,ds as Y,W as R,aq as L,X as Z,B as T,y as ee,z as te}from"./index-B6yCc2m_.js";import{E as w}from"./tree-CopuO4KQ.js";const ne=(e,{attrs:a,emit:u},{select:r,tree:d,key:c})=>{const f=U("tree-select");return A(()=>e.data,()=>{e.filterable&&x(()=>{var t,v;(v=d.value)==null||v.filter((t=r.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...S(q(e),Object.keys(j.props)),...a,"onUpdate:modelValue":t=>u(E,t),valueKey:c,popperClass:g(()=>{const t=[f.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var v;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(v=d.value)==null||v.filter(t)}}},le=P({extends:H,setup(e,a){const u=H.setup(e,a);delete u.selectOptionClick;const r=p().proxy;return x(()=>{u.select.states.cachedOptions.get(r.value)||u.select.onOptionCreate(r)}),A(()=>a.attrs.visible,d=>{u.states.visible=d},{immediate:!0}),u},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function I(e){return e||e===0}function F(e){return z(e)&&e.length}function b(e){return z(e)?e:I(e)?[e]:[]}function O(e,a,u,r,d){for(let c=0;c<e.length;c++){const f=e[c];if(a(f,c,e,d))return r?r(f,c,e,d):f;{const C=u(f);if(F(C)){const t=O(C,a,u,r,f);if(t)return t}}}}function M(e,a,u,r){for(let d=0;d<e.length;d++){const c=e[d];a(c,d,e,r);const f=u(c);F(f)&&M(f,a,u,c)}}const ce=(e,{attrs:a,slots:u,emit:r},{select:d,tree:c,key:f})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&x(()=>{const n=c.value;n&&!D(n.getCheckedKeys(),b(e.modelValue))&&n.setCheckedKeys(b(e.modelValue))})},{immediate:!0,deep:!0});const C=g(()=>({value:f.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(n,l)=>{var s;const o=C.value[n];return W(o)?o(l,(s=c.value)==null?void 0:s.getNode(t("value",l))):l[o]},v=b(e.modelValue).map(n=>O(e.data||[],l=>t("value",l)===n,l=>t("children",l),(l,s,o,h)=>h&&t("value",h))).filter(n=>I(n)),_=g(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const n=[];return M(e.data.concat(e.cacheData),l=>{const s=t("value",l);n.push({value:s,currentLabel:t("label",l),isDisabled:t("disabled",l)})},l=>t("children",l)),n}),K=()=>{var n;return(n=c.value)==null?void 0:n.getCheckedKeys().filter(l=>{var s;const o=(s=c.value)==null?void 0:s.getNode(l);return!X(o)&&$(o.childNodes)})};return{...S(q(e),Object.keys(w.props)),...a,nodeKey:f,expandOnClickNode:g(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:g(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(n,{node:l,data:s,store:o})=>n(le,{value:t("value",s),label:t("label",s),disabled:t("disabled",s),visible:l.visible},e.renderContent?()=>e.renderContent(n,{node:l,data:s,store:o}):u.default?()=>u.default({node:l,data:s,store:o}):void 0),filterNodeMethod:(n,l,s)=>e.filterNodeMethod?e.filterNodeMethod(n,l,s):n?new RegExp(G(n),"i").test(t("label",l)||""):!0,onNodeClick:(n,l,s)=>{var o,h,k,m;if((o=a.onNodeClick)==null||o.call(a,n,l,s),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!t("disabled",n)){const N=(h=d.value)==null?void 0:h.states.options.get(t("value",n));(k=d.value)==null||k.handleOptionSelect(N)}}else e.expandOnClickNode&&s.proxy.handleExpandIconClick();(m=d.value)==null||m.focus()}},onCheck:(n,l)=>{var s;if(!e.showCheckbox)return;const o=t("value",n),h={};M([c.value.store.root],i=>h[i.key]=i,i=>i.childNodes);const k=l.checkedKeys,m=e.multiple?b(e.modelValue).filter(i=>!(i in h)&&!k.includes(i)):[],N=m.concat(k);if(e.checkStrictly)r(E,e.multiple?N:N.includes(o)?o:void 0);else if(e.multiple){const i=K();r(E,m.concat(i))}else{const i=O([n],y=>!F(t("children",y))&&!t("disabled",y),y=>t("children",y)),V=i?t("value",i):void 0,B=I(e.modelValue)&&!!O([n],y=>t("value",y)===e.modelValue,y=>t("children",y));r(E,V===e.modelValue||B?void 0:V)}x(()=>{var i;const V=b(e.modelValue);c.value.setCheckedKeys(V),(i=a.onCheck)==null||i.call(a,n,{checkedKeys:c.value.getCheckedKeys(),checkedNodes:c.value.getCheckedNodes(),halfCheckedKeys:c.value.getHalfCheckedKeys(),halfCheckedNodes:c.value.getHalfCheckedNodes()})}),(s=d.value)==null||s.focus()},onNodeExpand:(n,l,s)=>{var o;(o=a.onNodeExpand)==null||o.call(a,n,l,s),x(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&l.checked){const h={},k=c.value.getCheckedKeys();M([c.value.store.root],i=>h[i.key]=i,i=>i.childNodes);const m=b(e.modelValue).filter(i=>!(i in h)&&!k.includes(i)),N=K();r(E,m.concat(N))}})},cacheOptions:_}};var ae=P({props:{data:{type:Array,default:()=>[]}},setup(e){const a=J(Q);return A(()=>e.data,()=>{var u;e.data.forEach(d=>{a.states.cachedOptions.has(d.value)||a.states.cachedOptions.set(d.value,d)});const r=((u=a.selectRef)==null?void 0:u.querySelectorAll("input"))||[];Y&&!Array.from(r).includes(document.activeElement)&&a.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const de=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...j.props,...w.props,cacheData:{type:Array,default:()=>[]}},setup(e,a){const{slots:u,expose:r}=a,d=R(),c=R(),f=g(()=>e.nodeKey||e.valueKey||"value"),C=ne(e,a,{select:d,tree:c,key:f}),{cacheOptions:t,...v}=ce(e,a,{select:d,tree:c,key:f}),_=L({});return r(_),Z(()=>{Object.assign(_,{...S(c.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...S(d.value,["focus","blur","selectedLabel"])})}),()=>T(j,L({...C,ref:K=>d.value=K}),{...u,default:()=>[T(ae,{data:t.value}),T(w,L({...v,ref:K=>c.value=K}))]})}});var se=ee(de,[["__file","tree-select.vue"]]);const oe=te(se);export{oe as E};
