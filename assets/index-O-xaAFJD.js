import{_ as Ue}from"./index-AmtRfZLy.js";import{aU as oe,W as h,o as R,b as M,w as l,d as e,av as me,aw as X,s as V,e as C,ay as ae,az as Z,E as P,aB as ee,_ as ce,a$ as L,aW as le,aq as Ee,b3 as Ne,a as Y,ad as E,bT as F,aI as ie,F as pe,aT as Re,aV as ne,ah as se,t as Q,bL as Se,bM as De,b6 as fe,b7 as _e,n as te,b8 as ve,c as ge,D as Me,b9 as j,bd as ye,a4 as be,$ as xe,ae as ke,a8 as he,bc as Oe,bb as Be,be as ze,bf as We,af as Te,a5 as Ae}from"./index-B6yCc2m_.js";import{_ as Ve}from"./index-BJMucfID.js";import{a as re}from"./index-C6QIYa0w.js";import{E as de,a as ue,_ as Ce}from"./index-6AfRRrL-.js";import{E as je}from"./date-picker-CO9Lkaff.js";import{E as we}from"./tree-CopuO4KQ.js";/* empty css                     */import{u as Fe,a as Le,l as Pe,s as qe,b as Ye,c as He,d as Ge,e as Je,r as Qe,p as Xe,f as Ze,g as el,h as ll}from"./index-BhLzFmKZ.js";import{E as tl}from"./index-3i5fdD-M.js";import"./index-CtEHLY2Q.js";const ol={__name:"role-search",emits:["search"],setup(O,{emit:S}){const $=S,[w,N]=oe({roleName:"",roleKey:""}),m=h(["",""]),p=()=>{const[c,d]=m.value||[];$("search",{...w,params:{beginTime:c,endTime:d}})},I=()=>{N(),m.value=["",""],p()};return(c,d)=>{const x=ae,K=Z,f=de,B=je,y=P,o=ue,g=ee,D=Ve;return R(),M(D,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[e(g,{"label-width":"72px",onKeyup:me(p,["enter"]),onSubmit:d[3]||(d[3]=X(()=>{},["prevent"]))},{default:l(()=>[e(o,{gutter:8},{default:l(()=>[e(f,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(K,{label:"角色名称"},{default:l(()=>[e(x,{clearable:"",modelValue:V(w).roleName,"onUpdate:modelValue":d[0]||(d[0]=r=>V(w).roleName=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(K,{label:"权限字符"},{default:l(()=>[e(x,{clearable:"",modelValue:V(w).roleKey,"onUpdate:modelValue":d[1]||(d[1]=r=>V(w).roleKey=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(K,{label:"创建时间"},{default:l(()=>[e(B,{"unlink-panels":"",type:"daterange",modelValue:m.value,"onUpdate:modelValue":d[2]||(d[2]=r=>m.value=r),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(K,{"label-width":"16px"},{default:l(()=>[e(y,{type:"primary",onClick:p},{default:l(()=>d[4]||(d[4]=[C("查询")])),_:1}),e(y,{onClick:I},{default:l(()=>d[5]||(d[5]=[C("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},al={style:{"line-height":"1",padding:"0 6px 0 0"}},nl={style:{height:"260px",overflow:"auto",padding:"0 6px"}},sl={__name:"role-edit",props:L({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:L(["done"],["update:modelValue"]),setup(O,{emit:S}){const $=O,w=S,N=le(O,"modelValue"),m=h(null),p=h([]),I=h(!1),c=h([]),d=h(!1),x=h(!1),K=h(null),[f,B,y]=oe({roleId:void 0,roleName:"",roleKey:"",roleSort:0,status:"0",remark:""}),o=Ee({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}],roleKey:[{required:!0,message:"请输入权限字符",type:"string",trigger:"blur"}],roleSort:[{required:!0,message:"请输入显示顺序",type:"number",trigger:"blur"}]}),g=()=>{N.value=!1},D=()=>{var i,t;(t=(i=K.value)==null?void 0:i.validate)==null||t.call(i,v=>{var U,b,W,q,G,A,J;if(!v)return;const k=(J=((W=(b=(U=m.value)==null?void 0:U.getCheckedKeys)==null?void 0:b.call(U))!=null?W:[]).concat((A=(G=(q=m.value)==null?void 0:q.getHalfCheckedKeys)==null?void 0:G.call(q))!=null?A:[]))!=null?J:[];x.value=!0,(d.value?Fe:Le)({...f,menuIds:k}).then(H=>{x.value=!1,E.success(H),g(),w("done")}).catch(H=>{x.value=!1,E.error(H.message)})})},r=()=>{F(p.value,i=>{var v,k;((k=(v=m.value)==null?void 0:v.getNode)==null?void 0:k.call(v,i)).expand(null,!1)})},a=()=>{F(p.value,i=>{var v,k;((k=(v=m.value)==null?void 0:v.getNode)==null?void 0:k.call(v,i)).collapse()})},s=()=>{var t,v;const i=[];F(p.value,k=>{i.push(k.id)}),(v=(t=m.value)==null?void 0:t.setCheckedKeys)==null||v.call(t,i)},n=()=>{var i,t;(t=(i=m.value)==null?void 0:i.setCheckedKeys)==null||t.call(i,[])},u=()=>{var i;p.value=[],c.value=[],I.value=!0,Pe((i=$.data)==null?void 0:i.roleId).then(t=>{I.value=!1,p.value=t.menus;const v=[];F(p.value,k=>{var T,U,b;!((T=k.children)!=null&&T.length)&&((b=(U=t.checkedKeys)==null?void 0:U.includes)!=null&&b.call(U,k.id))&&v.push(k.id)}),c.value=v}).catch(t=>{I.value=!1,E.error(t.message)})},_=()=>{$.data?(y($.data),d.value=!0):(B(),d.value=!1),u(),ie(()=>{ie(()=>{var i,t;(t=(i=K.value)==null?void 0:i.clearValidate)==null||t.call(i)})})};return(i,t)=>{const v=ae,k=Z,T=tl,U=de,b=pe,W=Re,q=ne,G=ue,A=P,J=we,H=Ce,$e=ee,Ke=se;return R(),M(Ke,{form:"",width:680,position:"center",modelValue:N.value,"onUpdate:modelValue":t[6]||(t[6]=z=>N.value=z),"body-style":{paddingLeft:"0px"},title:d.value?"修改角色":"添加角色",onOpen:_},{footer:l(()=>[e(A,{onClick:g},{default:l(()=>t[12]||(t[12]=[C("取消")])),_:1}),e(A,{type:"primary",loading:x.value,onClick:D},{default:l(()=>t[13]||(t[13]=[C(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[e($e,{ref_key:"formRef",ref:K,model:V(f),rules:o,"label-width":"108px",onSubmit:t[5]||(t[5]=X(()=>{},["prevent"]))},{default:l(()=>[e(G,null,{default:l(()=>[e(U,{sm:12,xs:24},{default:l(()=>[e(k,{label:"角色名称",prop:"roleName"},{default:l(()=>[e(v,{clearable:"",modelValue:V(f).roleName,"onUpdate:modelValue":t[0]||(t[0]=z=>V(f).roleName=z),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(k,{label:"显示顺序",prop:"roleSort"},{default:l(()=>[e(T,{min:0,max:99999,modelValue:V(f).roleSort,"onUpdate:modelValue":t[1]||(t[1]=z=>V(f).roleSort=z),placeholder:"请输入显示顺序","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{sm:12,xs:24},{default:l(()=>[e(k,{prop:"roleKey"},{label:l(()=>[e(W,{content:"控制器中定义的权限字符, 如: @PreAuthorize(`@ss.hasRole('admin')`)",bodyStyle:{maxWidth:"268px"},placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[e(b,{size:15,style:{"align-self":"center","margin-right":"2px",cursor:"help"}},{default:l(()=>[e(V(Ne),{style:{opacity:"0.6"}})]),_:1})]),_:1}),t[7]||(t[7]=Y("span",null,"权限字符",-1))]),default:l(()=>[e(v,{clearable:"",modelValue:V(f).roleKey,"onUpdate:modelValue":t[2]||(t[2]=z=>V(f).roleKey=z),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),e(k,{label:"状态",prop:"status"},{default:l(()=>[e(q,{code:"sys_normal_disable",type:"radio",modelValue:V(f).status,"onUpdate:modelValue":t[3]||(t[3]=z=>V(f).status=z)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{label:"菜单权限"},{default:l(()=>[e(H,{loading:I.value,class:"role-menu-tree"},{default:l(()=>[Y("div",al,[e(A,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:r},{default:l(()=>t[8]||(t[8]=[C(" 展开全部 ")])),_:1}),e(A,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:a},{default:l(()=>t[9]||(t[9]=[C(" 折叠全部 ")])),_:1}),e(A,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:s},{default:l(()=>t[10]||(t[10]=[C(" 全选 ")])),_:1}),e(A,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:n},{default:l(()=>t[11]||(t[11]=[C(" 取消全选 ")])),_:1})]),Y("div",nl,[e(J,{ref_key:"treeRef",ref:m,"show-checkbox":"","node-key":"id",data:p.value,"default-checked-keys":c.value},null,8,["data","default-checked-keys"])])]),_:1},8,["loading"])]),_:1}),e(k,{label:"备注"},{default:l(()=>[e(v,{rows:3,type:"textarea",modelValue:V(f).remark,"onUpdate:modelValue":t[4]||(t[4]=z=>V(f).remark=z),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},rl=ce(sl,[["__scopeId","data-v-b7922ab6"]]),dl={style:{"line-height":"1",padding:"0 6px 0 0"}},ul={style:{height:"260px",overflow:"auto",padding:"0 6px"}},il={__name:"role-auth",props:L({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:L(["done"],["update:modelValue"]),setup(O,{emit:S}){const $=O,w=S,N=le(O,"modelValue"),m=h(null),p=h([]),I=h(!1),c=h([]),d=h(""),x=h(!1),K=()=>{var u,_,i,t,v,k;if(d.value!=2)return[];const s=(i=(_=(u=m.value)==null?void 0:u.getCheckedKeys)==null?void 0:_.call(u))!=null?i:[],n=(k=(v=(t=m.value)==null?void 0:t.getHalfCheckedKeys)==null?void 0:v.call(t))!=null?k:[];return s.concat(n)},f=()=>{N.value=!1},B=()=>{var s;x.value=!0,qe({roleId:(s=$.data)==null?void 0:s.roleId,dataScope:d.value,deptIds:K()}).then(()=>{x.value=!1,E.success("修改成功"),f(),w("done")}).catch(n=>{x.value=!1,E.error(n.message)})},y=()=>{F(p.value,s=>{var u,_;((_=(u=m.value)==null?void 0:u.getNode)==null?void 0:_.call(u,s)).expand(null,!1)})},o=()=>{F(p.value,s=>{var u,_;((_=(u=m.value)==null?void 0:u.getNode)==null?void 0:_.call(u,s)).collapse()})},g=()=>{var n,u;const s=[];F(p.value,_=>{s.push(_.id)}),(u=(n=m.value)==null?void 0:n.setCheckedKeys)==null||u.call(n,s)},D=()=>{var s,n;(n=(s=m.value)==null?void 0:s.setCheckedKeys)==null||n.call(s,[])},r=()=>{var s;p.value=[],c.value=[],I.value=!0,Ye((s=$.data)==null?void 0:s.roleId).then(n=>{I.value=!1,p.value=n.depts;const u=[];F(p.value,_=>{var i,t,v;!((i=_.children)!=null&&i.length)&&((v=(t=n.checkedKeys)==null?void 0:t.includes)!=null&&v.call(t,_.id))&&u.push(_.id)}),c.value=u}).catch(n=>{I.value=!1,E.error(n.message)})},a=()=>{$.data?(d.value=$.data.dataScope,r()):d.value=""};return(s,n)=>{const u=Se,_=De,i=Z,t=P,v=we,k=Ce,T=ee,U=se;return R(),M(U,{form:"",width:460,title:"分配数据权限",modelValue:N.value,"onUpdate:modelValue":n[2]||(n[2]=b=>N.value=b),onOpen:a},{footer:l(()=>[e(t,{onClick:f},{default:l(()=>n[7]||(n[7]=[C("取消")])),_:1}),e(t,{type:"primary",loading:x.value,onClick:B},{default:l(()=>n[8]||(n[8]=[C(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[e(T,{"label-width":"80px",onSubmit:n[1]||(n[1]=X(()=>{},["prevent"]))},{default:l(()=>[e(i,{label:"权限范围"},{default:l(()=>[e(_,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=b=>d.value=b),placeholder:"请选择权限范围",class:"ele-fluid"},{default:l(()=>[e(u,{value:"1",label:"全部数据权限"}),e(u,{value:"2",label:"自定数据权限"}),e(u,{value:"3",label:"本部门数据权限"}),e(u,{value:"4",label:"本部门及以下数据权限"}),e(u,{value:"5",label:"仅本人数据权限"})]),_:1},8,["modelValue"])]),_:1}),d.value==2?(R(),M(i,{key:0,label:"数据权限"},{default:l(()=>[e(k,{loading:I.value,class:"role-auth-tree"},{default:l(()=>[Y("div",dl,[e(t,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:y},{default:l(()=>n[3]||(n[3]=[C(" 展开全部 ")])),_:1}),e(t,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:o},{default:l(()=>n[4]||(n[4]=[C(" 折叠全部 ")])),_:1}),e(t,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:g},{default:l(()=>n[5]||(n[5]=[C(" 全选 ")])),_:1}),e(t,{class:"ele-btn-icon",size:"small",style:{margin:"0 0 6px 6px"},onClick:D},{default:l(()=>n[6]||(n[6]=[C(" 取消全选 ")])),_:1})]),Y("div",ul,[e(v,{ref_key:"treeRef",ref:m,"show-checkbox":"","node-key":"id",data:p.value,"default-expand-all":!0,"default-checked-keys":c.value},null,8,["data","default-checked-keys"])])]),_:1},8,["loading"])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["modelValue"])}}},ml=ce(il,[["__scopeId","data-v-585da055"]]),Ie={__name:"role-user-search",emits:["search"],setup(O,{emit:S}){const $=S,[w,N]=oe({userName:"",phonenumber:""}),m=()=>{$("search",{...w})},p=()=>{N(),m()};return(I,c)=>{const d=ae,x=Z,K=de,f=P,B=ue,y=ee;return R(),M(y,{"label-width":"72px",onKeyup:me(m,["enter"]),onSubmit:c[2]||(c[2]=X(()=>{},["prevent"]))},{default:l(()=>[e(B,{gutter:8},{default:l(()=>[e(K,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(x,{label:"用户名称"},{default:l(()=>[e(d,{clearable:"",modelValue:V(w).userName,"onUpdate:modelValue":c[0]||(c[0]=o=>V(w).userName=o),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(x,{label:"手机号码"},{default:l(()=>[e(d,{clearable:"",modelValue:V(w).phonenumber,"onUpdate:modelValue":c[1]||(c[1]=o=>V(w).phonenumber=o),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{lg:8,md:8,sm:24,xs:24},{default:l(()=>[e(x,{"label-width":"16px"},{default:l(()=>[e(f,{type:"primary",onClick:m},{default:l(()=>c[3]||(c[3]=[C("查询")])),_:1}),e(f,{onClick:p},{default:l(()=>c[4]||(c[4]=[C("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},cl={__name:"role-user-select",props:L({roleId:Number},{modelValue:{type:Boolean},modelModifiers:{}}),emits:L(["done"],["update:modelValue"]),setup(O,{emit:S}){const $=O,w=S,N=le(O,"modelValue"),m=h(!1),p=h(null),I=h([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"userName",label:"用户名称",align:"center",minWidth:110},{prop:"nickName",label:"用户昵称",align:"center",minWidth:110},{prop:"email",label:"邮箱",align:"center",minWidth:110},{prop:"phonenumber",label:"手机号码",align:"center",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",slot:"status"},{prop:"createTime",label:"创建时间",align:"center",width:168}]),c=h([]),d=({pages:y,where:o})=>He({...o,...y,roleId:$.roleId}),x=y=>{var o,g;(g=(o=p.value)==null?void 0:o.reload)==null||g.call(o,{page:1,where:y})},K=()=>{N.value=!1},f=()=>{if(!c.value.length){E.error("请选择要分配的用户");return}m.value=!0;const y=c.value.map(o=>o.userId).join();Ge({roleId:$.roleId,userIds:y}).then(o=>{m.value=!1,E.success(o),K(),w("done")}).catch(o=>{m.value=!1,E.error(o.message)})},B=()=>{$.data?x():c.value=[]};return(y,o)=>{const g=ne,D=re,r=P,a=se;return R(),M(a,{width:880,title:"选择用户","body-style":{padding:"4px 16px"},"destroy-on-close":!0,modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=s=>N.value=s),onOpen:B},{footer:l(()=>[e(r,{onClick:K},{default:l(()=>o[2]||(o[2]=[C("取消")])),_:1}),e(r,{type:"primary",loading:m.value,onClick:f},{default:l(()=>o[3]||(o[3]=[C(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[e(Ie,{onSearch:x}),e(D,{ref_key:"tableRef",ref:p,"row-key":"userId",columns:I.value,datasource:d,"show-overflow-tooltip":!0,selections:c.value,"onUpdate:selections":o[0]||(o[0]=s=>c.value=s),"highlight-current-row":"",toolbar:!1,"empty-props":!1},{status:l(({row:s})=>[e(g,{code:"sys_common_status",type:"tag","model-value":s.status},null,8,["model-value"])]),_:1},8,["columns","selections"])]),_:1},8,["modelValue"])}}},pl={__name:"role-user",props:L({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const S=O,$=le(O,"modelValue"),{hasPermission:w}=fe(),[N]=_e(["sys_common_status"]),m=h(null),p=te(()=>{const y=[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"userName",label:"用户名称",align:"center",minWidth:110},{prop:"nickName",label:"用户昵称",align:"center",minWidth:110},{prop:"email",label:"邮箱",align:"center",minWidth:110},{prop:"phonenumber",label:"手机号码",align:"center",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",slot:"status",formatter:o=>{var g;return(g=N.value.find(D=>D.dictValue==o.status))==null?void 0:g.dictLabel}},{prop:"createTime",label:"创建时间",align:"center",width:180}];return w("system:role:remove")&&y.push({columnKey:"action",label:"操作",width:100,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}),y}),I=h([]),c=h(!1),d=({pages:y,where:o})=>{var g;return Je({...o,...y,roleId:(g=S.data)==null?void 0:g.roleId})},x=y=>{var o,g;(g=(o=m.value)==null?void 0:o.reload)==null||g.call(o,{where:y})},K=()=>{c.value=!0},f=y=>{const o=y==null?I.value:[y];if(!o.length){E.error("请至少选择一条数据");return}ke.confirm(`确认要取消该用户“${o.map(g=>g.userName).join()}”的角色吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{var D;const g=E.loading({message:"请求中..",plain:!0});Qe({roleId:(D=S.data)==null?void 0:D.roleId,userIds:o.map(r=>r.userId).join()}).then(()=>{g.close(),E.success("取消授权成功"),x()}).catch(r=>{g.close(),E.error(r.message)})}).catch(()=>{})},B=()=>{S.data?x():I.value=[]};return(y,o)=>{var u;const g=P,D=ne,r=he,a=re,s=Oe,n=ve("permission");return R(),ge(xe,null,[e(s,{size:980,style:{"max-width":"100%"},title:"分配用户","append-to-body":!0,"destroy-on-close":!0,modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=_=>$.value=_),"body-style":{paddingBottom:0,height:"100%",overflow:"auto",display:"flex",flexDirection:"column"},onOpen:B},{default:l(()=>[e(Ie,{style:{"margin-bottom":"-8px"},onSearch:x}),e(a,{ref_key:"tableRef",ref:m,"row-key":"userId",columns:p.value,datasource:d,"show-overflow-tooltip":!0,selections:I.value,"onUpdate:selections":o[2]||(o[2]=_=>I.value=_),"highlight-current-row":"","export-config":{fileName:"角色用户"},style:Me([{paddingBottom:"14px"},{flex:"1",display:"flex","flex-direction":"column",overflow:"auto"}]),"table-style":{flex:1,height:"100%",overflow:"hidden"}},{toolbar:l(()=>[j((R(),M(g,{type:"primary",class:"ele-btn-icon",icon:V(ye),onClick:o[0]||(o[0]=_=>K())},{default:l(()=>o[5]||(o[5]=[C(" 添加用户 ")])),_:1},8,["icon"])),[[n,"system:role:add"]]),j((R(),M(g,{type:"danger",class:"ele-btn-icon",icon:V(be),onClick:o[1]||(o[1]=_=>f())},{default:l(()=>o[6]||(o[6]=[C(" 批量取消 ")])),_:1},8,["icon"])),[[n,"system:role:remove"]])]),status:l(({row:_})=>[e(D,{code:"sys_common_status",type:"tag","model-value":_.status},null,8,["model-value"])]),action:l(({row:_})=>[e(r,{type:"danger",underline:!1,onClick:i=>f(_)},{default:l(()=>o[7]||(o[7]=[C(" 取消授权 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1},8,["modelValue"]),e(cl,{modelValue:c.value,"onUpdate:modelValue":o[4]||(o[4]=_=>c.value=_),"role-id":(u=O.data)==null?void 0:u.roleId,onDone:x},null,8,["modelValue","role-id"])],64)}}},wl=Object.assign({name:"SystemRole"},{__name:"index",setup(O){const{hasPermission:S}=fe(),[$]=_e(["sys_normal_disable"]),w=h(null),N=te(()=>[{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",align:"center",minWidth:110},{prop:"roleKey",label:"权限字符",align:"center",minWidth:110},{prop:"roleSort",label:"显示顺序",align:"center",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",slot:"status",filters:$.value.map(r=>({text:r.dictLabel,value:r.dictValue})),filterMultiple:!1,formatter:r=>{var a;return(a=$.value.find(s=>s.dictValue==r.status))==null?void 0:a.dictLabel}},{prop:"createTime",label:"创建时间",align:"center",width:180},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),m=h([]),p=h(null),I=h(!1),c=h(!1),d=h(!1),x=te(()=>{const r=[];return S("system:role:edit")&&r.push({title:"数据权限",command:"auth"}),S("system:role:edit")&&r.push({title:"分配用户",command:"user"}),r}),K=({pages:r,where:a,filters:s})=>Xe({...a,...s,...r}),f=r=>{var a,s;(s=(a=w.value)==null?void 0:a.reload)==null||s.call(a,{page:1,where:r})},B=r=>{p.value=r!=null?r:null,I.value=!0},y=r=>{const a=r==null?m.value:[r];if(!a.length){E.error("请至少选择一条数据");return}ke.confirm(`是否确认删除角色名称为"${a.map(s=>s.roleName).join()}"的数据项?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const s=E.loading({message:"请求中..",plain:!0});Ze(a.map(n=>n.roleId)).then(()=>{s.close(),E.success("删除成功"),f()}).catch(n=>{s.close(),E.error(n.message)})}).catch(()=>{})},o=()=>{var a,s;const r=E.loading({message:"请求中..",plain:!0});(s=(a=w.value)==null?void 0:a.fetch)==null||s.call(a,({where:n})=>{el(n).then(()=>{r.close()}).catch(u=>{r.close(),E.error(u.message)})})},g=(r,a)=>{r==="auth"?(p.value=a!=null?a:null,c.value=!0):r==="user"&&(p.value=a!=null?a:null,d.value=!0)},D=(r,a)=>{const s=r?"0":"1";ll(a.roleId,s).then(n=>{a.status=s,E.success(n)}).catch(n=>{E.error(n.message)})};return(r,a)=>{const s=P,n=We,u=he,_=Te,i=pe,t=Ae,v=re,k=Ve,T=Ue,U=ve("permission");return R(),M(T,null,{default:l(()=>[e(ol,{onSearch:f}),e(k,{"body-style":{paddingTop:"8px"}},{default:l(()=>[e(v,{ref_key:"tableRef",ref:w,"row-key":"roleId",columns:N.value,datasource:K,"show-overflow-tooltip":!0,selections:m.value,"onUpdate:selections":a[2]||(a[2]=b=>m.value=b),"highlight-current-row":"","export-config":{fileName:"角色数据"},"cache-key":"systemRoleTable"},{toolbar:l(()=>[j((R(),M(s,{type:"primary",class:"ele-btn-icon",icon:V(ye),onClick:a[0]||(a[0]=b=>B())},{default:l(()=>a[6]||(a[6]=[C(" 新建 ")])),_:1},8,["icon"])),[[U,"system:role:add"]]),j((R(),M(s,{type:"danger",class:"ele-btn-icon",icon:V(be),onClick:a[1]||(a[1]=b=>y())},{default:l(()=>a[7]||(a[7]=[C(" 删除 ")])),_:1},8,["icon"])),[[U,"system:role:remove"]]),j((R(),M(s,{class:"ele-btn-icon",icon:V(Be),onClick:o},{default:l(()=>a[8]||(a[8]=[C(" 导出 ")])),_:1},8,["icon"])),[[U,"system:role:export"]])]),status:l(({row:b})=>[e(n,{size:"small","model-value":b.status==0,onChange:W=>D(W,b)},null,8,["model-value","onChange"])]),action:l(({row:b})=>[b.roleId!==1?(R(),ge(xe,{key:0},[j((R(),M(u,{type:"primary",underline:!1,onClick:W=>B(b)},{default:l(()=>a[9]||(a[9]=[C(" 修改 ")])),_:2},1032,["onClick"])),[[U,"system:role:edit"]]),j(e(_,{direction:"vertical"},null,512),[[U,"system:role:remove"]]),j((R(),M(u,{type:"danger",underline:!1,onClick:W=>y(b)},{default:l(()=>a[10]||(a[10]=[C(" 删除 ")])),_:2},1032,["onClick"])),[[U,"system:role:remove"]]),x.value.length?(R(),M(_,{key:0,direction:"vertical"})):Q("",!0),x.value.length?(R(),M(t,{key:1,items:x.value,style:{display:"inline"},onCommand:W=>g(W,b)},{default:l(()=>[e(u,{type:"primary",underline:!1},{default:l(()=>[a[11]||(a[11]=Y("span",null,"更多",-1)),e(i,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:l(()=>[e(V(ze))]),_:1})]),_:1})]),_:2},1032,["items","onCommand"])):Q("",!0)],64)):Q("",!0)]),_:1},8,["columns","selections"])]),_:1}),e(rl,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=b=>I.value=b),data:p.value,onDone:f},null,8,["modelValue","data"]),e(ml,{modelValue:c.value,"onUpdate:modelValue":a[4]||(a[4]=b=>c.value=b),data:p.value,onDone:f},null,8,["modelValue","data"]),e(pl,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=b=>d.value=b),data:p.value},null,8,["modelValue","data"])]),_:1})}}});export{wl as default};
