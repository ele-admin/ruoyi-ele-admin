import{_ as ve}from"./index-AmtRfZLy.js";import{aU as ee,W as w,o as k,b as U,w as t,d as e,s as p,e as P,av as ye,aw as te,ay as J,az as le,E as H,aB as ae,a$ as B,aW as W,ad as I,c as O,$ as z,a0 as oe,bL as se,bM as ne,an as M,b0 as re,b1 as de,b2 as ue,aq as be,t as j,aI as L,aV as xe,ah as Q,_ as he,b9 as S,bC as Ve,a as Y,ae as A,B as X,f as we,a8 as ie,aA as ke,b6 as Ie,b7 as Ue,n as Z,ai as me,b8 as Ee,bd as $e,a4 as Ne,bw as Ce,bb as Re,be as De,bf as Pe,af as Me,F as Se,a5 as Te,aN as je,bR as Be,bI as Fe}from"./index-B6yCc2m_.js";import{_ as Oe}from"./index-BJMucfID.js";import{_ as We}from"./index-CcsYl2ST.js";import{E as pe,a as ce,v as Ke,_ as qe}from"./index-6AfRRrL-.js";import{E as ze}from"./tree-CopuO4KQ.js";import{a as fe}from"./index-C6QIYa0w.js";import{E as Le}from"./date-picker-CO9Lkaff.js";import{i as Ye}from"./index-BhLzFmKZ.js";import{l as Ae}from"./index-DP49cPFF.js";import{p as He,e as Ge,_ as Je,l as Qe}from"./dept-select-D-dWypkS.js";import{E as Xe}from"./upload-T9IYL6Sz.js";import"./progress-DH2nMyg8.js";import"./index-CtEHLY2Q.js";import"./tree-select-BVEOGY61.js";const Ze={__name:"user-search",emits:["search"],setup(n,{expose:a,emit:d}){const _=d,[v,b]=ee({userName:"",phonenumber:""}),V=w(["",""]),c=()=>{b(),V.value=["",""]},s=()=>{const[N,r]=V.value||[];_("search",{...v,params:{beginTime:N,endTime:r}})},g=()=>{c(),s()};return a({resetFields:c}),(N,r)=>{const u=J,i=le,y=pe,f=Le,o=H,E=ce,$=ae;return k(),U($,{"label-width":"72px",onKeyup:ye(s,["enter"]),onSubmit:r[3]||(r[3]=te(()=>{},["prevent"]))},{default:t(()=>[e(E,{gutter:8},{default:t(()=>[e(y,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(i,{label:"用户名称"},{default:t(()=>[e(u,{clearable:"",modelValue:p(v).userName,"onUpdate:modelValue":r[0]||(r[0]=D=>p(v).userName=D),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(i,{label:"手机号码"},{default:t(()=>[e(u,{clearable:"",modelValue:p(v).phonenumber,"onUpdate:modelValue":r[1]||(r[1]=D=>p(v).phonenumber=D),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(i,{label:"创建时间"},{default:t(()=>[e(f,{"unlink-panels":"",type:"daterange",modelValue:V.value,"onUpdate:modelValue":r[2]||(r[2]=D=>V.value=D),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(i,{"label-width":"16px"},{default:t(()=>[e(o,{type:"primary",onClick:s},{default:t(()=>r[4]||(r[4]=[P("查询")])),_:1}),e(o,{onClick:g},{default:t(()=>r[5]||(r[5]=[P("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},et={__name:"role-select",props:B({placeholder:{type:String,default:"请选择角色"}},{modelValue:{type:Array},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=W(n,"modelValue"),d=w([]);return Ye().then(_=>{d.value=_}).catch(_=>{I.error(_.message)}),(_,v)=>{const b=se,V=ne;return k(),U(V,{multiple:"",clearable:"",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=c=>a.value=c),placeholder:n.placeholder,class:"ele-fluid"},{default:t(()=>[(k(!0),O(z,null,oe(d.value,c=>(k(),U(b,{key:c.roleId,value:c.roleId,label:c.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])}}},tt={__name:"post-select",props:B({placeholder:{type:String,default:"请选择岗位"}},{modelValue:{type:Array},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=W(n,"modelValue"),d=w([]);return Ae().then(_=>{d.value=_}).catch(_=>{I.error(_.message)}),(_,v)=>{const b=se,V=ne;return k(),U(V,{multiple:"",clearable:"",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=c=>a.value=c),placeholder:n.placeholder,class:"ele-fluid"},{default:t(()=>[(k(!0),O(z,null,oe(d.value,c=>(k(),U(b,{key:c.postId,value:c.postId,label:c.postName},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])}}};async function lt(n){const a=await M.get("/system/user/list",{params:n});return a.data.code===200?a.data:Promise.reject(new Error(a.data.msg))}async function at(n){const a=await M.get("/system/user/"+n);return a.data.code===200?a.data:Promise.reject(new Error(a.data.msg))}async function ot(n){const a=await M.post("/system/user",n);return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}async function st(n){const a=await M.put("/system/user",n);return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}async function nt(n){const a=await M.delete("/system/user/"+n.join());return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}async function rt(n,a){const d=await M.put("/system/user/changeStatus",{userId:n,status:a});return d.data.code===200?d.data.msg:Promise.reject(new Error(d.data.msg))}async function dt(n,a){const d=await M.put("/system/user/resetPwd",{userId:n,password:a});return d.data.code===200?d.data.msg:Promise.reject(new Error(d.data.msg))}async function ut(n){const a=await M({url:"/system/user/export",method:"POST",data:re(n),responseType:"blob"});await de(a),ue(a.data,`user_${Date.now()}.xlsx`)}async function it(){const n=await M({url:"/system/user/importTemplate",method:"POST",responseType:"blob"});await de(n),ue(n.data,`user_template_${Date.now()}.xlsx`)}async function mt(n,a){const d=new FormData;d.append("file",n),d.append("updateSupport",a);const _=await M.post("/system/user/importData",d);return _.data.code===200?_.data.msg:Promise.reject(new Error(_.data.msg))}async function pt(n){const a=await M.get("/system/user/authRole/"+n);return a.data.code===200?a.data:Promise.reject(new Error(a.data.msg))}async function ct(n){const a=await M.put("/system/user/authRole",re(n));return a.data.code===200?a.data.msg:Promise.reject(new Error(a.data.msg))}const ft={__name:"user-edit",props:B({data:Object,deptId:Number},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(n,{emit:a}){const d=n,_=a,v=W(n,"modelValue"),b=w(!1),V=w(!1),c=w(null),[s,g,N]=ee({userId:void 0,deptId:void 0,nickName:"",phonenumber:"",userName:"",sex:void 0,email:"",password:"",status:"0",roleIds:[],postIds:[],remark:""}),r=be({nickName:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],phonenumber:[{pattern:He,message:"手机号格式不正确",type:"string",trigger:"blur"}],userName:[{required:!0,message:"请输入用户名称",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],email:[{pattern:Ge,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",pattern:/^[\S]{5,18}$/,message:"密码必须为5-18位非空白字符"}],roleIds:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}]}),u=()=>{v.value=!1},i=()=>{var f,o;(o=(f=c.value)==null?void 0:f.validate)==null||o.call(f,E=>{if(!E)return;V.value=!0,(b.value?st:ot)(s).then(D=>{V.value=!1,I.success(D),u(),_("done")}).catch(D=>{V.value=!1,I.error(D.message)})})},y=()=>{d.data?(N({...d.data,password:""}),at(d.data.userId).then(f=>{N({...d.data,roleIds:f.roleIds,postIds:f.postIds,password:""})}).catch(f=>{I.error(f.message)}),b.value=!0):(g(),s.deptId=d.deptId,b.value=!1),L(()=>{L(()=>{var f,o;(o=(f=c.value)==null?void 0:f.clearValidate)==null||o.call(f)})})};return(f,o)=>{const E=J,$=le,D=xe,K=pe,m=ce,l=ae,h=H,C=Q;return k(),U(C,{form:"",width:640,modelValue:v.value,"onUpdate:modelValue":o[12]||(o[12]=x=>v.value=x),title:b.value?"修改用户":"新建用户",onOpen:y},{footer:t(()=>[e(h,{onClick:u},{default:t(()=>o[13]||(o[13]=[P("取消")])),_:1}),e(h,{type:"primary",loading:V.value,onClick:i},{default:t(()=>o[14]||(o[14]=[P(" 保存 ")])),_:1},8,["loading"])]),default:t(()=>[e(l,{ref_key:"formRef",ref:c,model:p(s),rules:r,"label-width":"80px",onSubmit:o[11]||(o[11]=te(()=>{},["prevent"]))},{default:t(()=>[e(m,{gutter:16},{default:t(()=>[e(K,{sm:12,xs:24},{default:t(()=>[e($,{label:"用户昵称",prop:"nickName"},{default:t(()=>[e(E,{clearable:"",maxlength:30,modelValue:p(s).nickName,"onUpdate:modelValue":o[0]||(o[0]=x=>p(s).nickName=x),placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e($,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[e(E,{clearable:"",maxlength:11,modelValue:p(s).phonenumber,"onUpdate:modelValue":o[1]||(o[1]=x=>p(s).phonenumber=x),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),b.value?j("",!0):(k(),U($,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[e(E,{clearable:"",maxlength:30,modelValue:p(s).userName,"onUpdate:modelValue":o[2]||(o[2]=x=>p(s).userName=x),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1})),e($,{label:"用户性别",prop:"sex"},{default:t(()=>[e(D,{code:"sys_user_sex",modelValue:p(s).sex,"onUpdate:modelValue":o[3]||(o[3]=x=>p(s).sex=x),placeholder:"请选择用户性别"},null,8,["modelValue"])]),_:1}),e($,{label:"岗位",prop:"postIds"},{default:t(()=>[e(tt,{modelValue:p(s).postIds,"onUpdate:modelValue":o[4]||(o[4]=x=>p(s).postIds=x)},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{sm:12,xs:24},{default:t(()=>[e($,{label:"归属部门"},{default:t(()=>[e(Je,{modelValue:p(s).deptId,"onUpdate:modelValue":o[5]||(o[5]=x=>p(s).deptId=x)},null,8,["modelValue"])]),_:1}),e($,{label:"邮箱",prop:"email"},{default:t(()=>[e(E,{clearable:"",maxlength:50,modelValue:p(s).email,"onUpdate:modelValue":o[6]||(o[6]=x=>p(s).email=x),placeholder:"请输入邮箱",autocomplete:"off"},null,8,["modelValue"])]),_:1}),b.value?j("",!0):(k(),U($,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(E,{"show-password":"",type:"password",maxlength:20,modelValue:p(s).password,"onUpdate:modelValue":o[7]||(o[7]=x=>p(s).password=x),placeholder:"请输入用户密码",autocomplete:"off"},null,8,["modelValue"])]),_:1})),e($,{label:"状态",prop:"status"},{default:t(()=>[e(D,{code:"sys_normal_disable",type:"radio",modelValue:p(s).status,"onUpdate:modelValue":o[8]||(o[8]=x=>p(s).status=x)},null,8,["modelValue"])]),_:1}),e($,{label:"角色",prop:"roleIds"},{default:t(()=>[e(et,{modelValue:p(s).roleIds,"onUpdate:modelValue":o[9]||(o[9]=x=>p(s).roleIds=x)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{label:"备注"},{default:t(()=>[e(E,{type:"textarea",rows:3,modelValue:p(s).remark,"onUpdate:modelValue":o[10]||(o[10]=x=>p(s).remark=x),placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},_t={class:"user-import-upload"},gt={style:{display:"flex","align-items":"center"}},vt={__name:"user-import",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:B(["done"],["update:modelValue"]),setup(n,{emit:a}){const d=a,_=W(n,"modelValue"),v=w(!1),b=w(!1),V=s=>["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type)?s.size/1024/1024>10?(I.error("大小不能超过 10MB"),!1):(v.value=!0,mt(s,b.value).then(g=>{v.value=!1,A({type:"success",title:"导入结果",message:X("div",{innerHTML:g}),customStyle:{maxWidth:"442px"},draggable:!0}).then(()=>{}).catch(()=>{}),_.value=!1,d("done")}).catch(g=>{v.value=!1,A({type:"error",title:"导入结果",message:X("div",{innerHTML:g.message}),customStyle:{maxWidth:"442px"},draggable:!0}).then(()=>{}).catch(()=>{})}),!1):(I.error("只能选择 excel 文件"),!1),c=()=>{const s=I.loading({message:"请求中..",plain:!0});it().then(()=>{s.close()}).catch(g=>{s.close(),I.error(g.message)})};return(s,g)=>{const N=we,r=Xe,u=ie,i=ke,y=Q,f=Ke;return k(),U(y,{width:460,title:"用户导入","body-style":{paddingTop:"8px"},modelValue:_.value,"onUpdate:modelValue":g[1]||(g[1]=o=>_.value=o)},{default:t(()=>[S((k(),O("div",_t,[e(r,{drag:"",action:"",accept:".xls,.xlsx","show-upload-list":!1,"before-upload":V},{default:t(()=>[e(N,{type:"primary",icon:p(Ve),"icon-props":{size:52},style:{"margin-bottom":"10px"}},null,8,["icon"]),e(N,{type:"placeholder"},{default:t(()=>g[2]||(g[2]=[P("将文件拖到此处, 或点击上传")])),_:1})]),_:1})])),[[f,v.value]]),Y("div",gt,[e(N,{size:"sm",type:"secondary",style:{"line-height":"17px",flex:"1"}},{default:t(()=>[g[4]||(g[4]=Y("span",{style:{"padding-right":"8px"}},"只能上传 xls、xlsx 文件,",-1)),e(u,{type:"primary",underline:!1,style:{"font-size":"inherit","line-height":"inherit","vertical-align":"0"},onClick:c},{default:t(()=>g[3]||(g[3]=[P(" 下载模板 ")])),_:1})]),_:1}),e(i,{modelValue:b.value,"onUpdate:modelValue":g[0]||(g[0]=o=>b.value=o),style:{height:"18px","flex-shrink":"0"}},{default:t(()=>g[5]||(g[5]=[P(" 更新已存在用户 ")])),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},yt=he(vt,[["__scopeId","data-v-14390bd7"]]),bt={__name:"user-role",props:B({data:Object},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=n,d=W(n,"modelValue"),_=w(null),v=w([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",minWidth:110},{prop:"roleKey",label:"权限字符",minWidth:110},{prop:"createTime",label:"创建时间",align:"center",width:180}]),b=w([]),V=w([]),c=w(!1),s=()=>{d.value=!1},g=()=>{var i;c.value=!0;const u=b.value.map(y=>y.roleId).join();ct({userId:(i=a.data)==null?void 0:i.userId,roleIds:u}).then(()=>{c.value=!1,I.success("授权成功"),s()}).catch(y=>{c.value=!1,I.error(y.message)})},N=()=>{pt(a.data.userId).then(u=>{V.value=u.roles,L(()=>{var i,y;(y=(i=_.value)==null?void 0:i.setSelectedRows)==null||y.call(i,u.roles.filter(f=>f.flag))})}).catch(u=>{I.error(u.message)})},r=()=>{a.data?N():b.value=[]};return(u,i)=>{const y=fe,f=H,o=Q;return k(),U(o,{width:640,title:"分配角色","body-style":{padding:"4px 16px 8px 16px"},"destroy-on-close":!0,modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=E=>d.value=E),onOpen:r},{footer:t(()=>[e(f,{onClick:s},{default:t(()=>i[2]||(i[2]=[P("取消")])),_:1}),e(f,{type:"primary",loading:c.value,onClick:g},{default:t(()=>i[3]||(i[3]=[P(" 保存 ")])),_:1},8,["loading"])]),default:t(()=>[e(y,{ref_key:"tableRef",ref:_,"row-key":"roleId",columns:v.value,datasource:V.value,"show-overflow-tooltip":!0,selections:b.value,"onUpdate:selections":i[0]||(i[0]=E=>b.value=E),"highlight-current-row":"",pagination:!1,toolbar:!1,"empty-props":!1},null,8,["columns","datasource","selections"])]),_:1},8,["modelValue"])}}},xt={__name:"user-list",props:{deptId:Number},setup(n){const a=n,{hasPermission:d}=Ie(),[_]=Ue(["sys_normal_disable"]),v=w(null),b=w(null),V=Z(()=>[{type:"selection",columnKey:"selection",width:48,align:"center",fixed:"left",showOverflowTooltip:!1},{type:"index",columnKey:"index",width:48,align:"center",fixed:"left"},{prop:"userName",label:"用户名称",align:"center",minWidth:100},{prop:"nickName",label:"用户昵称",align:"center",minWidth:110},{prop:"dept.deptName",label:"部门",align:"center",minWidth:100},{prop:"phonenumber",label:"手机号码",align:"center",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",slot:"status",filters:_.value.map(m=>({text:m.dictLabel,value:m.dictValue})),filterMultiple:!1,formatter:m=>{var l;return(l=_.value.find(h=>h.dictValue==m.status))==null?void 0:l.dictLabel}},{prop:"createTime",label:"创建时间",align:"center",width:180},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),c=w([]),s=w(null),g=w(!1),N=w(!1),r=w(!1),u=Z(()=>{const m=[];return d("system:user:resetPwd")&&m.push({title:"重置密码",command:"password"}),d("system:user:edit")&&m.push({title:"分配角色",command:"role"}),m}),i=({pages:m,where:l,filters:h})=>lt({...l,...h,...m,deptId:a.deptId}),y=m=>{var l,h;(h=(l=b.value)==null?void 0:l.reload)==null||h.call(l,{page:1,where:m})},f=m=>{s.value=m!=null?m:null,g.value=!0},o=()=>{N.value=!0},E=m=>{const l=m==null?c.value:[m];if(!l.length){I.error("请至少选择一条数据");return}A.confirm(`是否确认删除用户名称为"${l.map(h=>h.userName).join()}"的数据项？`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const h=I.loading({message:"请求中..",plain:!0});nt(l.map(C=>C.userId)).then(()=>{h.close(),I.success("删除成功"),y()}).catch(C=>{h.close(),I.error(C.message)})}).catch(()=>{})},$=(m,l)=>{const h=m?"0":"1";rt(l.userId,h).then(C=>{l.status=h,I.success(C)}).catch(C=>{I.error(C.message)})},D=(m,l)=>{m==="password"?A.prompt(`请输入"${l.userName}"的新密码:`,"重置密码",{inputPlaceholder:"请输入5-18位非空白字符",inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:h})=>{dt(l.userId,h).then(C=>{I.success(C)}).catch(C=>{I.error(C.message)})}).catch(()=>{}):m==="role"&&(s.value=l!=null?l:null,r.value=!0)},K=()=>{var l,h;const m=I.loading({message:"请求中..",plain:!0});(h=(l=b.value)==null?void 0:l.fetch)==null||h.call(l,({where:C,orders:x,filters:q})=>{ut({...C,...x,...q}).then(()=>{m.close()}).catch(G=>{m.close(),I.error(G.message)})})};return me(()=>a.deptId,()=>{var m,l;(l=(m=v.value)==null?void 0:m.resetFields)==null||l.call(m),y({})}),(m,l)=>{const h=H,C=Pe,x=ie,q=Me,G=Se,_e=Te,ge=fe,T=Ee("permission");return k(),O(z,null,[e(Ze,{ref_key:"searchRef",ref:v,style:{"margin-bottom":"-14px"},onSearch:y},null,512),e(ge,{ref_key:"tableRef",ref:b,"row-key":"userId",columns:V.value,datasource:i,"show-overflow-tooltip":!0,selections:c.value,"onUpdate:selections":l[2]||(l[2]=R=>c.value=R),"highlight-current-row":"","export-config":{fileName:"用户数据"},style:{paddingBottom:"16px"},"cache-key":"systemUserTable"},{toolbar:t(()=>[S((k(),U(h,{type:"primary",class:"ele-btn-icon",icon:p($e),onClick:l[0]||(l[0]=R=>f())},{default:t(()=>l[6]||(l[6]=[P(" 新建 ")])),_:1},8,["icon"])),[[T,"system:user:add"]]),S((k(),U(h,{type:"danger",class:"ele-btn-icon hidden-sm-and-down",icon:p(Ne),onClick:l[1]||(l[1]=R=>E())},{default:t(()=>l[7]||(l[7]=[P(" 删除 ")])),_:1},8,["icon"])),[[T,"system:user:remove"]]),S((k(),U(h,{class:"ele-btn-icon",icon:p(Ce),onClick:o},{default:t(()=>l[8]||(l[8]=[P(" 导入 ")])),_:1},8,["icon"])),[[T,"system:user:import"]]),S((k(),U(h,{class:"ele-btn-icon",icon:p(Re),onClick:K},{default:t(()=>l[9]||(l[9]=[P(" 导出 ")])),_:1},8,["icon"])),[[T,"system:user:export"]])]),status:t(({row:R})=>[e(C,{size:"small","model-value":R.status==0,onChange:F=>$(F,R)},null,8,["model-value","onChange"])]),action:t(({row:R})=>[R.userId!==1?(k(),O(z,{key:0},[S((k(),U(x,{type:"primary",underline:!1,onClick:F=>f(R)},{default:t(()=>l[10]||(l[10]=[P(" 修改 ")])),_:2},1032,["onClick"])),[[T,"system:user:edit"]]),S(e(q,{direction:"vertical"},null,512),[[T,"system:user:remove"]]),S((k(),U(x,{type:"danger",underline:!1,onClick:F=>E(R)},{default:t(()=>l[11]||(l[11]=[P(" 删除 ")])),_:2},1032,["onClick"])),[[T,"system:user:remove"]]),u.value.length?(k(),U(q,{key:0,direction:"vertical"})):j("",!0),u.value.length?(k(),U(_e,{key:1,items:u.value,style:{display:"inline"},onCommand:F=>D(F,R)},{default:t(()=>[e(x,{type:"primary",underline:!1},{default:t(()=>[l[12]||(l[12]=Y("span",null,"更多",-1)),e(G,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:t(()=>[e(p(De))]),_:1})]),_:1})]),_:2},1032,["items","onCommand"])):j("",!0)],64)):j("",!0)]),_:1},8,["columns","selections"]),e(ft,{data:s.value,modelValue:g.value,"onUpdate:modelValue":l[3]||(l[3]=R=>g.value=R),"dept-id":n.deptId,onDone:y},null,8,["data","modelValue","dept-id"]),e(yt,{modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=R=>N.value=R),onDone:y},null,8,["modelValue"]),e(bt,{modelValue:r.value,"onUpdate:modelValue":l[5]||(l[5]=R=>r.value=R),data:s.value},null,8,["modelValue","data"])],64)}}},ht={style:{padding:"0 16px 12px 0"}},jt=Object.assign({name:"SystemUser"},{__name:"index",setup(n){const{mobile:a}=je(),d=w(null),_=w(null),v=w(!0),b=w([]),V=w(null),c=w(""),s=()=>{v.value=!0,Qe().then(r=>{v.value=!1,b.value=Fe({data:r,idField:"deptId",parentIdField:"parentId"}),L(()=>{g(b.value[0])})}).catch(r=>{v.value=!1,I.error(r.message)})},g=r=>{var u,i,y,f;V.value!=null&&a.value&&((i=(u=d.value)==null?void 0:u.toggleCollapse)==null||i.call(u,!0)),r&&r.deptId?(V.value=r,(f=(y=_.value)==null?void 0:y.setCurrentKey)==null||f.call(y,r.deptId)):V.value=null},N=(r,u)=>r?u.deptName&&u.deptName.includes(r):!0;return me(c,r=>{var u,i;(i=(u=_.value)==null?void 0:u.filter)==null||i.call(u,r)}),s(),(r,u)=>{const i=J,y=ze,f=qe,o=We,E=Oe,$=ve;return k(),U($,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:t(()=>[e(E,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:t(()=>[e(o,{ref_key:"splitRef",ref:d,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:t(()=>[V.value?(k(),U(xt,{key:0,"dept-id":V.value.deptId},null,8,["dept-id"])):j("",!0)]),default:t(()=>[Y("div",ht,[e(i,{clearable:"",modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=D=>c.value=D),placeholder:"输入部门名称搜索","prefix-icon":p(Be)},null,8,["modelValue","prefix-icon"])]),e(f,{loading:v.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:t(()=>[e(y,{ref_key:"treeRef",ref:_,data:b.value,"highlight-current":"","node-key":"deptId",props:{label:"deptName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":N,style:{"--ele-tree-item-height":"34px"},onNodeClick:g},null,8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})}}});export{jt as default};
