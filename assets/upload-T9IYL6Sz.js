import{ct as Q,cu as ue,cv as ce,l as A,cw as v,cx as W,cy as b,m as T,cz as ke,u as N,cA as K,W as de,n as G,o as g,b as U,w as $,c as S,$ as Ee,a0 as $e,q as m,s as t,av as pe,p as E,t as h,a as q,aw as B,d as P,F as O,cB as Ce,x as Y,D as Re,cC as we,cD as Fe,cE as Pe,cF as Se,cG as Le,cH as Ue,y as M,aD as Te,aC as J,cI as x,cJ as ee,cK as De,cL as _e,cM as Oe,cN as Be,ai as te,cO as je,Z as qe,A as Ne,cP as Ae,bz as se,al as ae,z as Ke}from"./index-B6yCc2m_.js";import{E as Me}from"./progress-DH2nMyg8.js";const fe=Symbol("uploadContextKey"),ze="ElUpload";class He extends Error{constructor(r,s,d,i){super(r),this.name="UploadAjaxError",this.status=s,this.method=d,this.url=i}}function ne(n,r,s){let d;return s.response?d=`${s.response.error||s.response}`:s.responseText?d=`${s.responseText}`:d=`fail to ${r.method} ${n} ${s.status}`,new He(d,s.status,r.method,n)}function Ie(n){const r=n.responseText||n.response;if(!r)return r;try{return JSON.parse(r)}catch(s){return r}}const Ve=n=>{typeof XMLHttpRequest>"u"&&Q(ze,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=n.action;r.upload&&r.upload.addEventListener("progress",u=>{const p=u;p.percent=u.total>0?u.loaded/u.total*100:0,n.onProgress(p)});const d=new FormData;if(n.data)for(const[u,p]of Object.entries(n.data))ue(p)&&p.length?d.append(u,...p):d.append(u,p);d.append(n.filename,n.file,n.file.name),r.addEventListener("error",()=>{n.onError(ne(s,n,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return n.onError(ne(s,n,r));n.onSuccess(Ie(r))}),r.open(n.method,s,!0),n.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const i=n.headers||{};if(i instanceof Headers)i.forEach((u,p)=>r.setRequestHeader(p,u));else for(const[u,p]of Object.entries(i))ce(p)||r.setRequestHeader(u,String(p));return r.send(d),r},ve=["text","picture","picture-card"];let Xe=1;const Z=()=>Date.now()+Xe++,me=A({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:v([Object,Function,Promise]),default:()=>W({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:v(Array),default:()=>W([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:v(Function),default:Ve},disabled:Boolean,limit:Number}),We=A({...me,beforeUpload:{type:v(Function),default:b},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:b},onChange:{type:v(Function),default:b},onPreview:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b},crossorigin:{type:v(String)}}),Ge=A({files:{type:v(Array),default:()=>W([])},disabled:{type:Boolean,default:!1},handlePreview:{type:v(Function),default:b},listType:{type:String,values:ve,default:"text"},crossorigin:{type:v(String)}}),Je={remove:n=>!!n},Ze=T({name:"ElUploadList"}),Qe=T({...Ze,props:Ge,emits:Je,setup(n,{emit:r}){const s=n,{t:d}=ke(),i=N("upload"),u=N("icon"),p=N("list"),k=K(),y=de(!1),R=G(()=>[i.b("list"),i.bm("list",s.listType),i.is("disabled",s.disabled)]),w=f=>{r("remove",f)};return(f,D)=>(g(),U(Ue,{tag:"ul",class:m(t(R)),name:t(p).b()},{default:$(()=>[(g(!0),S(Ee,null,$e(f.files,(a,o)=>(g(),S("li",{key:a.uid||a.name,class:m([t(i).be("list","item"),t(i).is(a.status),{focusing:y.value}]),tabindex:"0",onKeydown:pe(e=>!t(k)&&w(a),["delete"]),onFocus:e=>y.value=!0,onBlur:e=>y.value=!1,onClick:e=>y.value=!1},[E(f.$slots,"default",{file:a,index:o},()=>[f.listType==="picture"||a.status!=="uploading"&&f.listType==="picture-card"?(g(),S("img",{key:0,class:m(t(i).be("list","item-thumbnail")),src:a.url,crossorigin:f.crossorigin,alt:""},null,10,["src","crossorigin"])):h("v-if",!0),a.status==="uploading"||f.listType!=="picture-card"?(g(),S("div",{key:1,class:m(t(i).be("list","item-info"))},[q("a",{class:m(t(i).be("list","item-name")),onClick:B(e=>f.handlePreview(a),["prevent"])},[P(t(O),{class:m(t(u).m("document"))},{default:$(()=>[P(t(Ce))]),_:1},8,["class"]),q("span",{class:m(t(i).be("list","item-file-name")),title:a.name},Y(a.name),11,["title"])],10,["onClick"]),a.status==="uploading"?(g(),U(t(Me),{key:0,type:f.listType==="picture-card"?"circle":"line","stroke-width":f.listType==="picture-card"?6:2,percentage:Number(a.percentage),style:Re(f.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),q("label",{class:m(t(i).be("list","item-status-label"))},[f.listType==="text"?(g(),U(t(O),{key:0,class:m([t(u).m("upload-success"),t(u).m("circle-check")])},{default:$(()=>[P(t(we))]),_:1},8,["class"])):["picture-card","picture"].includes(f.listType)?(g(),U(t(O),{key:1,class:m([t(u).m("upload-success"),t(u).m("check")])},{default:$(()=>[P(t(Fe))]),_:1},8,["class"])):h("v-if",!0)],2),t(k)?h("v-if",!0):(g(),U(t(O),{key:2,class:m(t(u).m("close")),onClick:e=>w(a)},{default:$(()=>[P(t(Pe))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),t(k)?h("v-if",!0):(g(),S("i",{key:3,class:m(t(u).m("close-tip"))},Y(t(d)("el.upload.deleteTip")),3)),f.listType==="picture-card"?(g(),S("span",{key:4,class:m(t(i).be("list","item-actions"))},[q("span",{class:m(t(i).be("list","item-preview")),onClick:e=>f.handlePreview(a)},[P(t(O),{class:m(t(u).m("zoom-in"))},{default:$(()=>[P(t(Se))]),_:1},8,["class"])],10,["onClick"]),t(k)?h("v-if",!0):(g(),S("span",{key:0,class:m(t(i).be("list","item-delete")),onClick:e=>w(a)},[P(t(O),{class:m(t(u).m("delete"))},{default:$(()=>[P(t(Le))]),_:1},8,["class"])],10,["onClick"]))],2)):h("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),E(f.$slots,"append")]),_:3},8,["class","name"]))}});var oe=M(Qe,[["__file","upload-list.vue"]]);const Ye=A({disabled:{type:Boolean,default:!1}}),xe={file:n=>ue(n)},ye="ElUploadDrag",et=T({name:ye}),tt=T({...et,props:Ye,emits:xe,setup(n,{emit:r}){Te(fe)||Q(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=N("upload"),i=de(!1),u=K(),p=y=>{if(u.value)return;i.value=!1,y.stopPropagation();const R=Array.from(y.dataTransfer.files);r("file",R)},k=()=>{u.value||(i.value=!0)};return(y,R)=>(g(),S("div",{class:m([t(d).b("dragger"),t(d).is("dragover",i.value)]),onDrop:B(p,["prevent"]),onDragover:B(k,["prevent"]),onDragleave:B(w=>i.value=!1,["prevent"])},[E(y.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var st=M(tt,[["__file","upload-dragger.vue"]]);const at=A({...me,beforeUpload:{type:v(Function),default:b},onRemove:{type:v(Function),default:b},onStart:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b}}),nt=T({name:"ElUploadContent",inheritAttrs:!1}),ot=T({...nt,props:at,setup(n,{expose:r}){const s=n,d=N("upload"),i=K(),u=J({}),p=J(),k=e=>{if(e.length===0)return;const{autoUpload:c,limit:l,fileList:C,multiple:F,onStart:L,onExceed:z}=s;if(l&&C.length+e.length>l){z(e,C);return}F||(e=e.slice(0,1));for(const H of e){const j=H;j.uid=Z(),L(j),c&&y(j)}},y=async e=>{if(p.value.value="",!s.beforeUpload)return w(e);let c,l={};try{const F=s.data,L=s.beforeUpload(e);l=x(s.data)?ee(s.data):s.data,c=await L,x(s.data)&&De(F,l)&&(l=ee(s.data))}catch(F){c=!1}if(c===!1){s.onRemove(e);return}let C=e;c instanceof Blob&&(c instanceof File?C=c:C=new File([c],e.name,{type:e.type})),w(Object.assign(C,{uid:e.uid}),l)},R=async(e,c)=>Oe(e)?e(c):e,w=async(e,c)=>{const{headers:l,data:C,method:F,withCredentials:L,name:z,action:H,onProgress:j,onSuccess:ge,onError:he,httpRequest:be}=s;try{c=await R(c!=null?c:C,e)}catch(_){s.onRemove(e);return}const{uid:I}=e,V={headers:l||{},withCredentials:L,file:e,data:c,method:F,filename:z,action:H,onProgress:_=>{j(_,e)},onSuccess:_=>{ge(_,e),delete u.value[I]},onError:_=>{he(_,e),delete u.value[I]}},X=be(V);u.value[I]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},f=e=>{const c=e.target.files;c&&k(Array.from(c))},D=()=>{i.value||(p.value.value="",p.value.click())},a=()=>{D()};return r({abort:e=>{_e(u.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,C])=>{C instanceof XMLHttpRequest&&C.abort(),delete u.value[l]})},upload:y}),(e,c)=>(g(),S("div",{class:m([t(d).b(),t(d).m(e.listType),t(d).is("drag",e.drag),t(d).is("disabled",t(i))]),tabindex:t(i)?"-1":"0",onClick:D,onKeydown:pe(B(a,["self"]),["enter","space"])},[e.drag?(g(),U(st,{key:0,disabled:t(i),onFile:k},{default:$(()=>[E(e.$slots,"default")]),_:3},8,["disabled"])):E(e.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:p,class:m(t(d).e("input")),name:e.name,disabled:t(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:f,onClick:B(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var le=M(ot,[["__file","upload-content.vue"]]);const re="ElUpload",ie=n=>{var r;(r=n.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(n.url)},lt=(n,r)=>{const s=Be(n,"fileList",void 0,{passive:!0}),d=a=>s.value.find(o=>o.uid===a.uid);function i(a){var o;(o=r.value)==null||o.abort(a)}function u(a=["ready","uploading","success","fail"]){s.value=s.value.filter(o=>!a.includes(o.status))}function p(a){s.value=s.value.filter(o=>o.uid!==a.uid)}const k=(a,o)=>{const e=d(o);e&&(console.error(a),e.status="fail",p(e),n.onError(a,e,s.value),n.onChange(e,s.value))},y=(a,o)=>{const e=d(o);e&&(n.onProgress(a,e,s.value),e.status="uploading",e.percentage=Math.round(a.percent))},R=(a,o)=>{const e=d(o);e&&(e.status="success",e.response=a,n.onSuccess(a,e,s.value),n.onChange(e,s.value))},w=a=>{ce(a.uid)&&(a.uid=Z());const o={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(n.listType==="picture-card"||n.listType==="picture")try{o.url=URL.createObjectURL(a)}catch(e){je(re,e.message),n.onError(e,o,s.value)}s.value=[...s.value,o],n.onChange(o,s.value)},f=async a=>{const o=a instanceof File?d(a):a;o||Q(re,"file to be removed not found");const e=c=>{i(c),p(c),n.onRemove(c,s.value),ie(c)};n.beforeRemove?await n.beforeRemove(o,s.value)!==!1&&e(o):e(o)};function D(){s.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var o;return a&&((o=r.value)==null?void 0:o.upload(a))})}return te(()=>n.listType,a=>{a!=="picture-card"&&a!=="picture"||(s.value=s.value.map(o=>{const{raw:e,url:c}=o;if(!c&&e)try{o.url=URL.createObjectURL(e)}catch(l){n.onError(l,o,s.value)}return o}))}),te(s,a=>{for(const o of a)o.uid||(o.uid=Z()),o.status||(o.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:i,clearFiles:u,handleError:k,handleProgress:y,handleStart:w,handleSuccess:R,handleRemove:f,submit:D,revokeFileObjectURL:ie}},rt=T({name:"ElUpload"}),it=T({...rt,props:We,setup(n,{expose:r}){const s=n,d=K(),i=J(),{abort:u,submit:p,clearFiles:k,uploadFiles:y,handleStart:R,handleError:w,handleRemove:f,handleSuccess:D,handleProgress:a,revokeFileObjectURL:o}=lt(s,i),e=G(()=>s.listType==="picture-card"),c=G(()=>({...s,fileList:y.value,onStart:R,onProgress:a,onSuccess:D,onError:w,onRemove:f}));return qe(()=>{y.value.forEach(o)}),Ne(fe,{accept:Ae(s,"accept")}),r({abort:u,submit:p,clearFiles:k,handleStart:R,handleRemove:f}),(l,C)=>(g(),S("div",null,[t(e)&&l.showFileList?(g(),U(oe,{key:0,disabled:t(d),"list-type":l.listType,files:t(y),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(f)},se({append:$(()=>[P(le,ae({ref_key:"uploadRef",ref:i},t(c)),{default:$(()=>[l.$slots.trigger?E(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?E(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:$(({file:F,index:L})=>[E(l.$slots,"file",{file:F,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0),!t(e)||t(e)&&!l.showFileList?(g(),U(le,ae({key:1,ref_key:"uploadRef",ref:i},t(c)),{default:$(()=>[l.$slots.trigger?E(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?E(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),l.$slots.trigger?E(l.$slots,"default",{key:2}):h("v-if",!0),E(l.$slots,"tip"),!t(e)&&l.showFileList?(g(),U(oe,{key:3,disabled:t(d),"list-type":l.listType,files:t(y),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(f)},se({_:2},[l.$slots.file?{name:"default",fn:$(({file:F,index:L})=>[E(l.$slots,"file",{file:F,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0)]))}});var ut=M(it,[["__file","upload.vue"]]);const pt=Ke(ut);export{pt as E};
